<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>捐赠公示</title>
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">

    <link href="../../../jslib/hui/plugins/swiper/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../jslib/hui/css/Hui.css" rel="stylesheet" type="text/css" />
    <link href="../../../jslib/dropload/dropload.css" rel="stylesheet" type="text/css" />

    <style>
       /* body{
            background-color:#ebebeb;
        }*/

        .top_bg{
            background-color:#fff;
            /*padding:10px;*/
            /*padding-top:20px;*/
        }
        .bg_img{
            padding-top:20px;
            display: none;
        }


        .page_footer{
            background-color:#fff;
        }
        .page_box{
            /*display: inline-block;*/
            display: table;
            margin:0px auto;
            line-height: 12px;
            padding: 20px 0;
        }
        .page_box li{
            display: table-cell;
            font-size:12px;
        }
        .page_box li a{
            color:#999;
            float:left;
            padding: 5px 8px;
            text-decoration: none;
            transition:background-color .3s;
            border:1px solid #999;

        }
        .page_box li a:hover{
            background-color:#ff5357;
            color:#fff;
        }

        .page_box li a.active{
            background-color:#ff5357;
            color:#fff;
            border:1px solid #ff5357;
        }

        .page_box .first, .page_box .end{
            color: #ff5357;
            border:1px solid transparent;
            width:24px;
        }
        .page_box .pre, .page_box .next{
            width:36px;
        }


        /*test*/
        .page_wrap {
            background-color:#fff;
            margin: 0 auto;
            text-align: center;
        }

        .pagerbar{
            padding: 15px 20px;
            color: #ccc;
            text-align:center;
        }
        .pagerbar a{
            text-decoration: none;
            display: inline-block;
            color:#ff5357;
            font-size:12px;
            height: 20px;
            line-height: 20px;
            padding: 2px 8px;
            border: 1px solid #ddd;
            margin: 0 2px;
            vertical-align: middle;
        }
        .pagerbar a:hover{
            text-decoration: none;
            border: 1px solid #ff5357;
        }
        .pagerbar span.current{
            display: inline-block;
            height: 20px;
            line-height: 20px;
            padding: 2px 8px;
            margin: 0 2px;
            color: #fff;
            font-size:12px;
            background-color: #ff5357;
            border: 1px solid #ff5357;
            vertical-align: middle;
        }

        .pagerbar span.disabled{
            display: inline-block;
            height: 20px;
            line-height: 20px;
            padding: 2px 8px;
            margin: 0 2px;
            color: #bfbfbf;
            font-size:12px;
            background: #f2f2f2;
            border: 1px solid #bfbfbf;
            vertical-align: middle;
        }

        /*首页尾页*/
        .pagerbar .first, .pagerbar .last{
            border:1px solid transparent;
            color:#999;
        }
        .pagerbar .first:hover, .pagerbar .last:hover{
            border:1px solid transparent;
            color:#ff5357;
        }

        .tip{
            color: #9b9b9b;
            font-size: 12px;
            text-align: center;
            margin-bottom: 0;
            margin-top: 0;
            padding: 5px 0;
            background-color:#ffe2e3;
        }


    </style>

    <!--加载列表模板-->
    <script type="text/html" id="tppl">
        <%for(var i in list.rows){%>

        <div class="H-qq-item H-vertical-middle H-overflow-hidden">
            <div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-border-vertical-bottom-after H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-touch-active">
                <div style="width:50px;height:50px;">
                    <img onerror="javascript:this.src='img/donate_avatar.png';" src="<%=B.getImageAbsoluteUrl(list.rows[i].picture)%>"
                         class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both">
                </div>
                <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden">
                    <div class="H-width-100-percent">
                        <%if(list.rows[i].anonymous && list.rows[i].anonymous == '1'){%>
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-16 H-text-show-row-1 H-theme-font-color15">
                            匿名
                        </strong>
                        <%}else{%>
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-16 H-text-show-row-1 H-theme-font-color15">
                            <%=list.rows[i].donorName%>
                        </strong>
                        <%}%>
                        <%if(list.rows[i].project.projectName && list.rows[i].project.projectName!=''){%>
                        <div class="H-theme-font-color-999 H-font-size-14 H-padding-vertical-top-3 H-text-show-row-1"><%=list.rows[i].project.projectName%></div>
                        <%}else{%>
                        <div class="H-theme-font-color-999 H-font-size-14 H-padding-vertical-top-3 H-text-show-row-1"></div>
                        <%}%>
                    </div>
                </div>
                <div class="H-font-size-12 H-theme-font-color-999 white-space-nowrap H-text-align-right">
                    <%if(list.rows[i].donationType && list.rows[i].donationType=='10'){%>
                        <label class="H-display-block H-font-size-16" style="color:#ff4f4f;">
                            <%=list.rows[i].money%>
                        <span style="">元</span></label>
                    <%}else{%>
                        <label class="H-display-block H-font-size-16" style="color:#ff4f4f;">
                            <%=list.rows[i].itemNum %>
                        </label>
                    <%}%>
                    <span class="H-badge H-display-inline-block H-margin-vertical-top-8 H-font-size-12 H-theme-font-color-999">
                        <%=list.rows[i].absoluteTime%>
                    </span>
                </div>
            </div>
        </div>

        <%}%>

    </script>


</head>
<body>
<!--top-banner-->
<div class="top_wrap" style="background-color:#ebebeb;padding-bottom:10px;">
<div class="top_bg">
    <div class="bg_img">
        <img id="top_banner" src="" style="width:100%;">

        <p class="tip">统计金额不包括实物价值</p>

        <!--<div class="num_left" style="">
            <div class="txt">总人数</div>
            <div class="person_num">101010</div>
        </div>
        <div class="num_right" style="">
            <div class="txt">捐赠总额</div>
            <div class="money_num">101010.00</div>
        </div>-->
    </div>
</div>
</div>
<!--donate list-->
<div class="content">
    <div class="donate_list">
<!--
        <div class="H-qq-item H-vertical-middle H-overflow-hidden">
            <div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-border-vertical-bottom-after H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-touch-active">
                <div style="width:50px;height:50px;">
                    <img src="img/donate_avatar.png" class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both">
                </div>
                <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden">
                    <div class="H-width-100-percent">
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-16 H-text-show-row-1 H-theme-font-color15">宁静</strong>
                        <div class="H-theme-font-color-999 H-font-size-14 H-padding-vertical-top-3 H-text-show-row-1">
                            一切从简，只为了更懒！Hui是新生帝个人开发，版权所有为中山赢友网络科技有限公司，Hui基于最新的HTML5，CSS3，ECMAScript开发，并且是一款非常棒的开源项目。也希望更多开发者能够参与进来，一起完善她，成就她！
                        </div>
                    </div>
                </div>
                <div class="H-font-size-12 H-theme-font-color-999 white-space-nowrap H-text-align-right">
                    <label class="H-display-block H-font-size-16" style="color:#ff4f4f;">2000.00元</label>
                    <span class="H-badge H-display-inline-block H-margin-vertical-top-8 H-font-size-12 H-theme-font-color-999">2017.12.12</span>
                </div>
            </div>
        </div>

        <div class="H-qq-item H-vertical-middle H-overflow-hidden">
            <div class="H-flexbox-horizontal H-box-sizing-border-box H-theme-background-color-white H-border-vertical-bottom-after H-clear-both H-padding-horizontal-both-10 H-padding-vertical-both-8 H-touch-active">
                <div style="width:50px;height:50px;"><img src="img/donate_avatar.png" class="H-width-100-percent H-height-100-percent H-display-block H-border-radius-circle H-border-both"></div>
                <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden">
                    <div class="H-width-100-percent">
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-16 H-text-show-row-1 H-theme-font-color15">宁静</strong>
                        <div class="H-theme-font-color-999 H-font-size-14 H-padding-vertical-top-3 H-text-show-row-1">
                            一切从简，只为了更懒！Hui是新生帝个人开发，版权所有为中山赢友网络科技有限公司，Hui基于最新的HTML5，CSS3，ECMAScript开发，并且是一款非常棒的开源项目。也希望更多开发者能够参与进来，一起完善她，成就她！</div>
                    </div>
                </div>
                <div class="H-font-size-12 H-theme-font-color-999 white-space-nowrap H-text-align-right">
                    <label class="H-display-block H-font-size-16" style="color:#ff4f4f;">2000.00元</label>
                    <span class="H-badge H-display-inline-block H-margin-vertical-top-8 H-font-size-12 H-theme-font-color-999">2017.12.12</span>
                </div>
            </div>
            &lt;!&ndash;
             <div class="H-qq-menu H-vertical-middle H-position-relative H-overflow-hidden">
                 <div class="H-font-size-16 H-padding-horizontal-both-20 H-theme-background-color1 H-display-block H-theme-font-color-white white-space-nowrap">置顶</div>
                 <div class="H-font-size-16 H-padding-horizontal-both-20 H-theme-background-color-red H-display-block H-theme-font-color-white white-space-nowrap">删除</div>
             </div>&ndash;&gt;
        </div>-->
    </div>
</div>

</body>


<!--js-->
<script src="../../../jslib/hui/script/H.js" type="text/javascript"></script>
<script src="../../js/B.js" type="text/javascript" ></script>
<script src="../../../jslib/xdomain.min.js" type="text/javascript"></script>
<script src="../../../jslib/zepto/zepto.min.js" type="text/javascript"></script>
<script src="../../../jslib/dropload/dropload.js" type="text/javascript"></script>
<script src="../../js/jbase64.js" type="text/javascript"></script>
<script src="../../js/wechat.js" type="text/javascript"></script>


<script>

    //接收URL中的参数
    var accountNum = B.getUrlParamByName("accountNum");
    var openId = localStorage.getItem("openId");
    if(openId && openId != 'null') {
        // 微信端
        accountNum = localStorage.getItem("accountNum");
        $("title").html("捐赠公示");

            // 微信端
            var shareData = {
                title: '捐赠公示',
                desc: '',
                link: location.href.split('?')[0],
                imgUrl: ''
            };
            mkShareInfo(location.href, shareData, 0);

    }else{
        //app或网页
        $("title").html('{"title":"捐赠公示","backUrl":"/foundation/dynamic_list.html?accountNum=' + accountNum+'","backTitle":"返回"}');
    }


    //页面初始化
    $(function(){

        //判断是否被认证
//        checkVerify();

        //定义模板标签符
        H.tppl_flag = ["<%","%>"];

        //初始加载页面的时候, canvas展示的数据初始为0
        //定时显示:
        setTimeout(function () {
            $('.bg_img').show();
            myCanvas(0,0);

            //加载 动态捐赠列表
            loadDynamicList();
        },100);





    });

    //合成canvas
    function myCanvas(d1,d2){
        data = ['总人数', d1, '捐赠总额', d2];
//        console.log(d1+"---"+d2);

        var canvas = document.createElement('canvas');
        canvas.width = "978";
        canvas.height = "387";

        var ctx = canvas.getContext("2d");
        ctx.rect(0, 0, 978, 387);
        ctx.fillStyle = "#fff";
        ctx.fill();

        // 字体和字号
        ctx.font = '42px PingFang-SC-Regular';
        ctx.fillStyle = '#262626';
        ctx.textAlign="center";

        ctx.fillText(data[0], 150, 200);
        ctx.fillText(data[1], 150, 260);
        ctx.fillText(data[2], 800, 200);
        ctx.fillText(data[3], 800, 260);

        var img = document.createElement("img");
        img.setAttribute('crossOrigin', 'anonymous');

        //原图地址
        img.src = 'img/dynamic_banner.png';

        img.addEventListener("load",function(){
            ctx.drawImage(img, 0, 0);
            imageURL = canvas.toDataURL("image/png");
            var imageElement = document.getElementById('top_banner');
            imageElement.src = imageURL;
        }, false);
    }


    //上拉加载,下拉刷新列表
    function loadDynamicList() {

        B.ready(function () {

            //初始化当前页码
            var page = 1;
            // 分页参数
            var pageSize = 5; //每页展示的数量--rows

            //初始化节点
            $('.donate_list').empty(); //移除donate_list节点中的内容
            $('.dropload-up').remove(); //移除整个dropload-up节点
            $('.dropload-down').remove();

            //下拉刷新上拉加载
            $('.content').dropload({
                scrollArea: window,
                domDown:{
                    domClass   : 'dropload-down',
                    domRefresh : '<div class="dropload-refresh">↑上拉加载更多-捐赠列表</div>',
                    domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>',
                },
                //上拉加载
                loadDownFn:function(me){

                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command": "73","content": {"page":"'+page+'","rows":"'+pageSize+'"}}'
                        },
                        dataType: 'json',
                        success: function(data){

                            if(data.obj.rows.length ==0){
                                me.lock();
                                me.noData(true);
                            }else{
                                //画布合成banner
                                if(page == 1){
                                    myCanvas( data.obj.totalPeople, returnFloat(data.obj.totalMoney) );
                                }

                                var render = H.tppl(H.D('#tppl').innerHTML);
                                var result = render({list:data.obj});

                                $('.donate_list').append(result);
                                page++;
                            }

                            // 每次数据加载完，必须重置
                            me.resetload();

                        },
                        error: function(xhr, type){
                            // 即使加载出错，也得重置
                            // me.resetload();
                        }
                    });

                },
                threshold:50
            });
        });

    }

    function returnFloat(value){
        var value=Math.round(parseFloat(value)*100)/100;
        var xsd=value.toString().split(".");
        if(xsd.length==1){
            value=value.toString()+".00";
            return value;
        }
        if(xsd.length>1){
            if(xsd[1].length<2){
                value=value.toString()+"0";
            }
            return value;
        }
    }

</script>
</html>