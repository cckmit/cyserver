<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>我的社团</title>
    <link href="../static/plug/swiper/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/Hui.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/dropload.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/team.css" rel="stylesheet" type="text/css" />


    <!--提取表单-->
    <style type="text/css">
        #project .cy-label {
            min-width: 60px;
        }
    </style>

    <!--置于底部的"发起"按钮 样式-->
    <style type="text/css">

        #float-menu{
            position:fixed;
            z-index: 5;
            bottom:50px;
        }
    </style>


</head>

<body class="H-flexbox-vertical">


<!--浮动的"发起"按钮-->
<span id="float-menu" class="H-icon H-center-all H-font-size-18 H-theme-background-color3 H-border-radius-circle H-margin-horizontal-auto"
      style="height: 42px; width: 42px;left: 10px;bottom: 115px; display: none">
        <i class="H-iconfont H-icon-add H-font-size-22 H-theme-font-color-white"></i>
</span>

<!--top img-->
<div class="H-horizontal-center H-theme-background-color-black H-overflow-hidden H-padding-vertical-bottom-10 team-banner-box" style="min-height:200px;">

    <!--gonggao icon-->
    <!--
    <div tapmode="" onclick="H.openWin('gonggao_list', 'gonggao_list.html');" class="gonggao-box H-position-absolute" style="right: 45px;top: 10px;">
        <div class="H-position-relative">
            <div class="gonggao_icon"><img src="../static/img/gg.png"></div>
            <span class="H-badge H-display-inline-block H-position-absolute" style="left: 17px;top: 23px;">
                <label class="H-display-inline-block H-vertical-middle H-theme-font-color-white H-font-size-10 img-bck">2</label>
            </span>
        </div>
    </div>
-->

    <!--avatar+name+prise-->
    <div class="H-overflow-hidden H-max-width-100-percent H-padding-horizontal-both-10 H-box-sizing-border-box" style="margin:25px auto;">
            <div class="picture H-margin-horizontal-auto " style="width: 96px; height: 96px;">
                <img id="userAvatar" onerror="javascript:this.src='../static/img/icons/default_profile.png';" src="" class="H-display-block H-border-radius-circle" alt="" title=""
                     style="width: 90px; height: 90px; border:3px solid rgba(255,255,255,0.3);">
            </div>
            <div  class="H-display-block H-font-weight-normal H-font-weight-500 H-font-size-18 H-theme-font-color-white
        H-text-align-center H-margin-vertical-top-5">
                <span id="userName"></span>
                <i id="sex_flag" class="H-iconfont H-font-size-18 H-margin-horizontal-right-5"></i>
            </div>

    </div>

    <!--顶层社团tabs: 我的社团|社团活动-->
    <div class="tab-group team-tabs-group H-tabs-channel H-overflow-scrolling H-position-absolute H-width-100-percent" >
        <ul class="H-width-100-percent H-auto-height H-flexbox-horizontal H-clear-both H-theme-background-color-transparent H-padding-8 H-box-sizing-border-box H-theme-font-color-999" style="font-size:16px;">
            <li tapmode="" onclick="getMyTeam()"
                class="wodeshetuan H-channel-item H-flex-item H-tabs-active H-theme-font-color1 H-margin-horizontal-right-5
                H-text-align-center">我的社团
            </li>|
            <li tapmode="" onclick="getTeamActivityList('.team_activity_content',99)"
                class="shetuankuodong H-channel-item H-flex-item  H-margin-horizontal-right-5 H-text-align-center">社团活动
            </li>
        </ul>
    </div>
</div>



<!--我的社团|社团活动content -->
 <div class="H-tabs-items">

     <!--我的社团-->
     <div class="my_team_list H-tabs-item">

         <!--参加社团状态条tabs: 已加入|我申请的|已取消-->
         <div class="status_tabs_channel H-margin-horizontal-both-10 H-margin-vertical-both-15">
             <ul class="status_channel_list H-flexbox-horizontal H-theme-background-color-white H-border-radius-9">
                 <li tapmode="" onclick="getTeamList('.added_team_content',1)" class="status_channel_item  H-theme-font-color1 H-flex-item H-text-show-row-1 H-padding-vertical-both-10 H-box-sizing-border-box H-touch-active
H-font-size-14 H-center-all jiaru">
                    <i class="H-iconfont H-icon-radio-null H-display-block H-font-size-12 H-padding-horizontal-right-5 jiatu_i"></i>
                    已加入
                 </li>
                 <li tapmode="" onclick="getTeamList('.applied_team_content',2)" class="status_channel_item H-theme-font-color-999 H-flex-item H-text-show-row-1 H-padding-vertical-both-10 H-box-sizing-border-box H-touch-active
H-font-size-14  H-center-all shenqing">
                    <i class="H-iconfont H-icon-radio-fill H-display-block H-icon-shopping-cart H-font-size-12 H-padding-horizontal-right-5 shenq_i"></i>
                    我申请的
                 </li>
                 <li tapmode="" onclick="getTeamList('.canceled_team_content',3)" class="status_channel_item H-theme-font-color-999 H-flex-item H-text-show-row-1 H-padding-vertical-both-10 H-box-sizing-border-box H-touch-active
H-font-size-14 H-center-all quxiao">
                    <i class="H-iconfont H-icon-radio-fill H-display-block H-icon-tag  H-font-size-12 H-padding-horizontal-right-5 qiuxiao_i"></i>
                    已取消
                 </li>
             </ul>
         </div>

         <!--参加社团状态 指向的 内容项-->
         <div class="status_tabs_items">
             <!--已加入content-->
             <div class="added_team_content">
                <div class="added_team_list status_tabs_item"></div>
             </div>
             <!--我申请的 content-->
             <div class="applied_team_content">
                <div class="applied_team_list status_tabs_item"></div>
             </div>
             <!--已取消的 content-->
             <div class="canceled_team_content">
                 <div class="canceled_team_list status_tabs_item"></div>
             </div>
         </div>


     </div>

     <!--社团活动 内容-->
     <div class="team_activity_content">
        <div class="team_activity_list H-tabs-item ">

        </div>
     </div>

     <!--发起 计划 form-->
     <div class="create_plan H-display-none-important">
         <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-both-after H-vertical-middle">
            <span class="H-icon H-display-block H-margin-horizontal-left-15">
                <!--<i class="H-iconfont H-icon-profile H-font-size-18 H-vertical-middle H-theme-font-color1"></i>-->
                <i class="icon iconfont icon-zhuti H-font-size-18 H-vertical-middle H-theme-font-color14"></i>
            </span>
             <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">主题：</span>
             <input type="text" id="topic" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box
            H-border-none H-outline-none H-padding-12" placeholder="请输入主题">

         </div>
         <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-both-after H-vertical-middle">
            <span class="H-icon H-display-block H-margin-horizontal-left-15">
                <!--<i class="H-iconfont H-icon-tip-msg H-font-size-18 H-vertical-middle H-theme-font-color2"></i>-->
                <i class="icon iconfont icon-renshu H-font-size-18 H-vertical-middle H-theme-font-color11"></i>
            </span>
             <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">人数：</span>
             <input type="text" id="plannedPeopleNum" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box
            H-border-none H-outline-none H-padding-12 " placeholder="请输入人数">
         </div>
         <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-both-after H-vertical-middle">
            <span class="H-icon H-display-block H-margin-horizontal-left-15">
                <!--<i class="H-iconfont H-icon-weixin H-font-size-18 H-vertical-middle H-theme-font-color6"></i>-->
                <i class="icon iconfont icon-shijian H-font-size-18 H-vertical-middle H-theme-font-color6"></i>
            </span>
             <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">时间：</span>
             <input type="text" id="backSchoolTime" type="datetime-local"
                    class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box
            H-border-none H-outline-none H-padding-12" placeholder="请选择返校时间"
                    readonly="readonly" tapmode="" onclick="H.dateTip(this);">

         </div>
         <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-both-after H-vertical-middle">
            <span class="H-icon H-display-block H-margin-horizontal-left-15">
                <!--<i class="H-iconfont H-icon-friends H-font-size-18 H-vertical-middle H-theme-font-color7"></i>-->
                <i class="icon iconfont icon-banjiquan H-font-size-18 H-vertical-middle H-theme-font-color10"></i>
            </span>
             <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">班级：</span>
             <input type="text" id="classItem" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box
            H-border-none H-outline-none H-padding-12" placeholder="请输入班级">
         </div>
         <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-both-after H-vertical-middle">
            <span class="H-icon H-display-block H-margin-horizontal-left-15">
                <!--<i class="H-iconfont H-icon-where H-font-size-18 H-vertical-middle H-theme-font-color5"></i>-->
                <i class="icon iconfont icon-huodong H-font-size-18 H-vertical-middle H-theme-font-color13"></i>
            </span>
             <span class="H-vertical-middle H-padding-10 H-font-size-16">活动：</span>
         </div>

         <div class="H-flexbox-horizontal H-padding-15 ">
             <div class="H-position-relative H-width-100-percent">
                 <div class="H-chatbox-bugle H-theme-border-color-white H-position-absolute H-z-index-100 H-bugle-top" style="top: -15px;"></div>
                 <textarea id="describe" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item
                 H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-width-100-percent" placeholder="请输入活动内容">
                </textarea>
             </div>
         </div>
         <!--发起计划 按钮-->
         <div class="H-padding-horizontal-both-15">
             <button id="submitBtn" onclick="createPlan();"
                     class="H-button H-width-100-percent  H-font-size-16 H-outline-none H-padding-vertical-both-15 H-padding-horizontal-both-20
        H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click
        H-theme-font-color1-click H-border-radius-3">发起</button>
         </div>
     </div>
</div>


<script src="../static/plug/swiper/swiper.min.js" type="text/javascript"></script>
<script src="../../js/H.js" type="text/javascript"></script>
<script src="../../js/zepto.min.js" type="text/javascript" ></script>
<script src="../../js/xdomain.min.js" type="text/javascript"></script>
<script src="../../js/B.js" type="text/javascript" ></script>
<script src="../static/js/lrz.mobile.min.js"></script>
<script src="../static/js/dropload.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="../../js/jbase64.js" ></script>
<script type="text/javascript" src="../../js/wechat.js" ></script>

<!--点击tab, 显示其中的页面-->
<script type="text/javascript">
    H.on(H.Ds(".H-tabs-channel ul li"), "touchend", function (event) {

        //对顶层的tab选择 channelItem = H.getParents(event.target, "H-channel-item");var index = H.getIndex(channelItem);
        var channel_item = H.getParents(event.target, "H-channel-item"); //顶层选择 社团tab
        var index = H.getIndex(channel_item);

        H.addClass(channel_item, "H-tabs-active H-theme-font-color1"); //对其选择的tab添加active,增加其主题颜色
        H.removeClass(H.siblings(channel_item), "H-tabs-active H-theme-font-color1");//去除其他tab的activ,去除其主题是
        H.addClass(H.siblings(channel_item), "H-theme-font-color-999"); // 为其他tab添加一个灰色,表示未激活状态

        if(index==0) {
            //我的社团
            //进入 "我的社团"之前,先把 "社团活动"内容清楚
            var activityContent = H.D(".team_activity_content");
            H.addClass(activityContent, "H-display-none-important");

            //并且默认进入的是"我的社团"-已加入列表
            //channel 重新置换颜色
            //显示已加入
            var addedTeam = H.D(".added_team_content");
            H.removeClass(addedTeam, "H-display-none-important");
//            H.addClass(H.siblings(addedTeam), "H-display-none-important");


            //显示 已加入|我申请的|已取消的
            var sonChannels = H.D(".status_tabs_channel");
            H.removeClass(sonChannels, "H-display-none-important");

            var myTeamList = H.D(".my_team_list");
            H.removeClass(myTeamList, "H-display-none-important");

            H.addClass(sonChannels, "H-display-important"); //my_team_list

            //我的社团channel-->内容:   我的社团: 已加入
            var tabContent = H.D(".added_team_list");
            H.removeClass(tabContent, "H-display-none-important");
            H.addClass(H.siblings(tabContent), "H-display-none-important");
        }else if(index==1){

            //我的channel-->内容:社团活动
            tabContent = H.D(".team_activity_content");
            H.removeClass(tabContent, "H-display-none-important");
            H.addClass(H.siblings(tabContent), "H-display-none-important");

        }
    });


    //点击"我的活动"中的状态选择条,点击其中的单选按钮, 就显示相应的内容(stauts_item)
    H.on(H.Ds(".status_tabs_channel ul li"), "touchend", function (event) {

        var status_channel = H.getParents(event.target, "status_channel_item");
        var index2 = H.getIndex(status_channel);
        H.addClass(status_channel, "H-tabs-active H-theme-font-color1"); //对其选择的tab添加active,增加其主题颜色
        H.removeClass(H.siblings(status_channel), "H-tabs-active H-theme-font-color1");//去除其他tab的activ,去除其主题是
        H.addClass(H.siblings(status_channel), "H-theme-font-color-999"); // 为其他tab添加一个灰色,表示未激活状态


        //不显示 "社团活动"内容
        var activityContent = H.D(".team_activity_content");
        H.addClass(activityContent, "H-display-none-important");

        if(index2==0) {
            //显示 已加入
            //我的社团channel-->内容:   我的社团: 已加入
            var tabContent = H.D(".added_team_content");
            H.removeClass(tabContent, "H-display-none-important");
            H.addClass(H.siblings(tabContent), "H-display-none-important");
        }else if(index2==1){
            //我申请的
            tabContent = H.D(".applied_team_content");
            H.removeClass(tabContent, "H-display-none-important");
            H.addClass(H.siblings(tabContent), "H-display-none-important");

        }else if(index2==2){
            //已取消的
            //我的channel-->内容:社团活动
            tabContent = H.D(".canceled_team_content");
            H.removeClass(tabContent, "H-display-none-important");
            H.addClass(H.siblings(tabContent), "H-display-none-important");

        }
    });
</script>

<!--滑动, 可以删除-->
<!--<script type="text/javascript">


    //################## 侧滑全部代码
    //返回角度
    function GetSlideAngle(dx, dy) {
        return Math.atan2(dy, dx) * 180 / Math.PI;
    }

    //根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动
    function GetSlideDirection(startX, startY, endX, endY) {
        var dy = startY - endY;
        var dx = endX - startX;
        var result = 0;

        //如果滑动距离太短
        if (Math.abs(dx) < 2 && Math.abs(dy) < 2) {
            return result;
        }

        var angle = GetSlideAngle(dx, dy);
        if (angle >= -45 && angle < 45) {
            result = 4;
        } else if (angle >= 45 && angle < 135) {
            result = 1;
        } else if (angle >= -135 && angle < -45) {
            result = 2;
        }
        else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
            result = 3;
        }

        return result;
    }

    var _startX = 0;
    var _startY = 0;
    var scrollHeight = 0;
    var scrollWidth = 0;
    var currentRange = 0;
    var parentEle = null;
    var direction = 1;

    // 设置侧滑动画
    function setScroll(parentElement, value, time) {
        parentElement.firstElementChild.style.cssText = "-webkit-transition: transform " + time + "s;-webkit-transform:translateX(" + value + "px);";
        parentElement.lastElementChild.style.cssText = "-webkit-transition: transform " + time + "s;-webkit-transform:translateX(" + value + "px);";
    }

    // 触摸开始
    window.addEventListener("touchstart", function (event) {
        if (event.targetTouches.length == 1) {
            var touch = event.targetTouches[0];
            parentEle = H.getParents(event.target, "team_activity_item");
            if (H.isElement(parentEle)) {

                // 其他兄弟隐藏
                var siblings = H.siblings(parentEle);
                for (var i = 0; i < siblings.length; i++) {
                    var _siblingObj = siblings[i];
                    setScroll(_siblingObj, 0, 0);
                }

                scrollHeight = parentEle.firstElementChild.clientHeight;
                scrollWidth = H.D(".team_activity_menu", parentEle).clientWidth;

                for (var i = 0; i < parentEle.lastElementChild.childNodes.length; i++) {
                    var child = parentEle.lastElementChild.childNodes[i];
                    if (H.isElement(child)) {
                        child.style.cssText = "height:" + scrollHeight + "px;line-height:" + scrollHeight + "px;";
                    }
                }

                currentRange = Number(parentEle.firstElementChild.style.WebkitTransform.replace(/translateX\(/g, "").replace(/px\)/g, ""));
                _startX = touch.pageX;
                _startY = touch.pageY;
            }
        }
    }, false);
    // 触摸过程
    window.addEventListener("touchmove", function (event) {
        if (event.targetTouches.length == 1) {
            var touch = event.targetTouches[0];
            direction = GetSlideDirection(_startX, _startY, touch.pageX, touch.pageY);
            if (direction == 3 || direction == 4) {
                event.preventDefault();
                if (H.isElement(parentEle)) {
                    var range = touch.pageX - _startX;
                    if (range <= 0) {
                        if (range - currentRange >= -scrollWidth && range - currentRange <= 0) {
                            setScroll(parentEle, (range - currentRange), 0);
                        }
                    }
                    else {
                        if (range + currentRange <= 0) {
                            setScroll(parentEle, (range + currentRange), 0);
                        }
                    }
                }
            }
        }
    }, false);
    // 触摸接触
    window.addEventListener("touchend", function (event) {
        var touch = event.targetTouches[0];
        if (H.isElement(parentEle)) {
            currentRange = Number(parentEle.firstElementChild.style.WebkitTransform.replace(/translateX\(/g, "").replace(/px\)/g, ""));
            if (direction == 3 && (currentRange < 0)) {
                setScroll(parentEle, -scrollWidth, 0.4);
            }
            else if (direction == 4 && currentRange < 80) {
                setScroll(parentEle, 0, 0.4);
            }
            else {
                setScroll(parentEle, 0, 0.4);
            }
        }
    }, false);
    // 点击
    window.addEventListener("click", function (event) {
        var parentEle = H.getParents(event.target, "team_activity_item");
        if (H.isElement(parentEle)) {
            setScroll(parentEle, 0, 0.4);
        }
    }, false);
</script>-->


<!-- 社团活动 模板-->
<script type="text/html" id="activityTppl">
    <%for(var key in list){%>
   <div tapmode="" onclick="H.openWin('active_content', '../activity/detail.html?accountNum=<%=accountNum%>&eventId=<%=list[key].id%>&sourceFlag=10');"
         class="team_activity_item H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after"
        style="position: relative;">

        <div class="H-padding-vertical-both-10">
            <img onerror="javascript:this.src='../static/img/banner4@3x.png';"
             src="<%=B.getImageAbsoluteUrl(list[key].picUrl)%>" alt="" title="" class="H-display-block H-margin-horizontal-left-10" style="width: 90px; height: 105px;">
        </div>
        <div class="H-flex-item H-padding-10">
            <strong class="H-font-weight-normal font-weight-500 H-font-size-16 H-display-block  H-text-show-row-1"> <%=list[key].title%></strong>
            <div class="H-font-size-14 H-text-show-row-1 H-padding-horizontal-left-0 H-theme-font-color-999 H-margin-vertical-top-5">
                <label class="H-iconfont H-icon-where H-font-size-14"></label>
                <label><%=list[key].place%></label>
            </div>
            <div class="H-font-size-14 H-text-show-row-1 H-padding-horizontal-left-0 H-theme-font-color-999 H-margin-vertical-top-5">
                <label class="H-iconfont H-icon-time H-font-size-14"></label>
                <label><%=list[key].startTime.substring(0,11)%>-- <%=list[key].endTime.substring(0,11)%></label>
            </div>
            <div class="H-font-size-14 H-text-show-row-1 H-padding-horizontal-left-0 H-theme-font-color-999 H-margin-vertical-top-5">
                <label class="H-iconfont H-icon-user2 H-font-size-14"></label>
                <label><%=list[key].signupNum%><%if(list[key].maxPeople==0){%><%}else{%>/<%=list[key].maxPeople%><%}%></label>
            </div>
        </div>

    </div>

    <%}%>
</script>


<!--我的社团 模板-->
<script type="text/html" id="myTeamTppl">
    <%
    for(var key in list){
    %>
    <div tapmode="" onclick="detailTeam('<%=list[key].id%>')"
         class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after">
        <div class="H-padding-vertical-both-10" tapmode="" >
            <img onerror="javascript:this.src='../static/img/banner4@3x.png';" src="<%=B.getImageAbsoluteUrl(list[key].posterUrl)%>" alt="" title=""
                 class="H-display-block H-margin-horizontal-left-10 H-border-radius-5"
                 style="width: 75px; height: 75px;">
        </div>

        <div class="H-flex-item H-padding-10" style="width: 100%;overflow: hidden">
            <div class="H-flexbox-horizontal">
                <strong class="H-flex-item H-font-weight-normal font-weight-500 H-font-size-14 H-display-block H-text-show-row-1" style="margin-top:-2px"><%=list[key].name%></strong>
                <span class="create-date H-flex-item H-text-align-right H-padding-horizontal-right-10 H-font-size-12 H-theme-font-color-ccc">
                    <%if(list[key].createDate){%>
                        <%=list[key].createDate.split(' ')[0]%>
                    <%}%>
                </span>
            </div>
            <div class="H-font-size-12 H-theme-font-color-999 H-text-show-row-2 H-margin-vertical-top-2" style="height: 32px;overflow: hidden">
                <%=list[key].introduction%>
            </div>
            <div class="H-theme-font-color-ccc H-font-size-12 H-margin-vertical-top-5">
                <span>人数: <%=list[key].memberCount%></span>
                <span class="H-margin-horizontal-both-5">|</span>
                <span>活动: <%=list[key].eventNum%></span>
            </div>

        </div>
    </div>

    <%
    }
    %>
</script>



<!--动态获取数据-->
<script type="text/javascript">
    // 接收参数
    var teamId = B.getUrlParamByName("teamId");
    var accountNum = B.getUrlParamByName("accountNum");

    var openId = localStorage.getItem("openId");
    if(openId && openId != "null") {

        // 微信端
        accountNum = localStorage.getItem("accountNum");

        if(!accountNum || accountNum == ''){

            //H.openWin("登陆页面", "../../wechat/login.html?backUrl=" + B.encrypt('../services/activity/list_user.html')+"&ts=" + B.getRandomInt(4));
            H.openWin("登陆页面", "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + B.encrypt('../services/team/my_team.html'));

        }
        var shareData = {
            title: '我的社團',
            desc: '',
            link: location.href.split('?')[0],
            imgUrl: ''
        };
        mkShareInfo(location.href, shareData, 1);
    }

    // 初始化页面
    $(function(){

        // 定义模板标识符
        H.tppl_flag = ["<%", "%>"];

        //一进入到my_team.html的页面, 就默认显示"我的社团"--"已加入"状态列表

        //点击 "发起", 显示"发起"计划表单tab
        H.D('#float-menu').style.left='0px';
        H.D('#float-menu').style.top=$(window).height()/2+'px';
        H.D("#float-menu").addEventListener("touchmove",function(event){
            //H.alert($(window).width()+"px"+$(window).height()+"px");
            event.preventDefault();//阻止其他事件
            if(event.targetTouches.length==1) {
                var touch = event.targetTouches[0];  // 把元素放在手指所在的位置
                //console.log(event);
                H.D('#float-menu').style.left = (touch.clientX-30) + 'px';
                H.D('#float-menu').style.top = (touch.clientY-30) + 'px';
                if(parseInt(H.D('#float-menu').style.left)<0){
                    H.D('#float-menu').style.left = '0px';
                }
                if(parseInt(H.D('#float-menu').style.top)<0){
                    H.D('#float-menu').style.top = '0px';
                }
                if(parseInt(H.D('#float-menu').style.left)>(parseInt($(window).width())-42)){
                    H.D('#float-menu').style.left=(parseInt($(window).width())-42)+'px';
                }
                if(parseInt(H.D('#float-menu').style.top)>(parseInt($(window).height())-42)){
                    H.D('#float-menu').style.top=(parseInt($(window).height())-42)+'px';
                }
            }
        });

        //点击"发起" ,展示 发起 表单
        H.D("#float-menu").addEventListener("click",function(event){
//            H.openWin('发起计划', "add_plan.html?accountNum="+accountNum);
            var createPlan = H.D(".H-channel-item");
            H.removeClass(createPlan,"H-theme-font-color1");
            H.addClass(createPlan, "H-theme-font-color-ccc");

            var createPlan = H.D(".create_plan");
            H.removeClass(createPlan, "H-display-none-important");
            H.addClass(H.siblings(createPlan), "H-display-none-important");


        });


        B.ready(function(){
            getUserInfo();

        });
        getTeamList('.added_team_content',1); //初始化进入"我的社团"-已加入 列表
    });

    //获取用户的学习经历,从中得到"班级"信息
    function getClassList() {

        B.ready(function () {
            $.ajax({
                type: 'POST',
                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                data:{
                    jsonStr:'{"command": "101",  "content": { "accountNum": "'+accountNum+'"} }'
                },
                dataType: 'json',
                success: function(data){
                    var classList = new Array();
                    var classItemList = new Array();

                    if(data && data.obj && data.obj.length > 0){
                        classList = data.obj;
//                        alert("班级个数==="+classList.length);
                        //将每个班级放入array中
                        for(var i=0; i<classList.length; i++){
                            classItemList[i]=classList[i].strClass;
//                            alert("classItem= "+classItemList[i]);
                        }
                        $('#classItem').click(function () {
                            H.selectTip(this, classItemList);
                        });

//                        var render = H.tppl(H.D("#bannerTppl").innerHTML);
//                        var result = render({bannerList:data.obj.rows});

//                        $('#bannerList').append(result);


                    }
                },
                error: function(xhr, type){
                    // 加载出错
                }
            });

        })
    }

    //点击"我的社团",
    function getMyTeam() {
        $('.shetuankuodong').attr("onclick","getTeamActivityList('.team_activity_content',99)")
        $('.wodeshetuan').removeAttr('onclick')

        getTeamList('.added_team_content',1);//点击"我的社团",默认加载的是"已加入"列表
        $(".status_tabs_channel ul li").eq(0).addClass("H-tabs-active H-theme-font-color1 H-theme-font-color-999").
        siblings().removeClass("H-tabs-active H-theme-font-color1");
    }

    //社团列表: type:0-全部, 1-已加入,2申请中 3.已取消
    function getTeamList(content,type) {
        var $content = $(content);

        $('.added_team_list').empty();
        $('.applied_team_list').empty();
        $('.canceled_team_list').empty();
        $('.dropload-up').remove();
        $('.dropload-down').remove();

        if(type==1){
            $('.jiatu_i').addClass('H-icon-radio-null').removeClass('H-icon-radio-fill');
            $('.shenq_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');
            $('.qiuxiao_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');

            $('.jiaru').removeAttr('onclick');
            $('.shenqing').attr('onclick','getTeamList(".applied_team_content",2)');
            $('.quxiao').attr('onclick','getTeamList(".canceled_team_content",3)');
        }else if(type==2){
            $('.jiatu_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');
            $('.shenq_i').addClass('H-icon-radio-null').removeClass('H-icon-radio-fill');
            $('.qiuxiao_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');

            $('.jiaru').attr('onclick','getTeamList(".added_team_content",1)');
            $('.shenqing').removeAttr('onclick');
            $('.quxiao').attr('onclick','getTeamList(".canceled_team_content",3)');
        }else{
            $('.jiatu_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');
            $('.shenq_i').addClass('H-icon-radio-fill').removeClass('H-icon-radio-null');
            $('.qiuxiao_i').addClass('H-icon-radio-null').removeClass('H-icon-radio-fill');;

            $('.jiaru').attr('onclick','getTeamList(".added_team_content",1)');
            $('.shenqing').attr('onclick','getTeamList(".applied_team_content",2)');
            $('.quxiao').removeAttr('onclick');
        }


        B.ready(function () {
            var page=1;

            $content.dropload({

                scrollArea: window,
                domUp: {
                    domClass: 'dropload-up',
                    domRefresh: '<div class="dropload-refresh">↓下拉刷新-我的社团</div>',
                    domUpdate: '<div class="dropload-update">↑释放更新-我的社团</div>',
                    domLoad: '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>'
                },
                domDown: {
                    domClass: 'dropload-down',
                    domRefresh: '<div class="dropload-refresh">↑上拉加载更多-我的社团</div>',
                    domLoad: '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>',
                    domNoData: '<div class="dropload-noData"> </div>'

                },

                loadDownFn: function (me) {

                $.ajax({
                        type: 'post',
                        url: B.serverUrl + '/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data: {
                            jsonStr: '{"command": "252","content": {"page": \"'+page+'\","rows": "3","type": "' + type + '","userAccount": "'+accountNum+'"}}'
                        },
                        dataType: 'json',
                        success: function (data) {
                            console.log('{"command": "252","content": {"page": \"'+page+'\","rows": "3","type": "' + type + '","userAccount": "'+accountNum+'"}}')
                            if (!data.success || data.obj.rows.length == 0) {
                                me.lock();
                                me.noData(true);
                            } else {

                                var list,result;

                                if(content =='.added_team_content' ) {
                                    // 我的社团-已加入的
                                    list = '.added_team_list';
                                }else if(content =='.applied_team_content'){
                                    list = '.applied_team_list';
                                }else if(content =='.canceled_team_content'){
                                    list = '.canceled_team_list';
                                }
                                var myRender = H.tppl(H.D("#myTeamTppl").innerHTML);
                                result = myRender({list: data.obj.rows});
                                $(list).append(result);
                                page++;

                            }

                            // 每次数据加载完，必须重置
                            me.resetload();
                            me.unlock();
                            me.noData(false);
                        },
                        error: function(xhr, type){
                            // 即使加载出错aler，也得重置
                            me.resetload();
                            me.noData(true);
                        }
                 });
                },

            })

        })


    }

    //社团活动列表: type:99
    function getTeamActivityList(content2, type){

        $('.shetuankuodong').removeAttr('onclick')
        $('.wodeshetuan').attr('onclick','getMyTeam()')

        //console.log("content2="+content2+"| type="+type);

        var $content2 = $(content2);

        $('.dropload-up').remove();
        $('.dropload-down').remove();
        $('.team_activity_list').empty();


        B.ready(function () {
            var page=1;

            $content2.dropload({

                scrollArea : window,
                domUp : {
                    domClass: 'dropload-up',
                    domRefresh: '<div class="dropload-refresh">↓下拉刷新-我的社团</div>',
                    domUpdate: '<div class="dropload-update">↑释放更新-我的社团</div>',
                    domLoad: '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>'
                },
                domDown:{
                    domClass   : 'dropload-down',
                    domRefresh : '<div class="dropload-refresh">↑上拉加载更多-我的社团</div>',
                    domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>',
                    domNoData  : '<div class="dropload-noData"> </div>'

                },

                loadDownFn:function(me){
//                    alert('{"command": "61","content": {"page": \"'+page+'\","rows": "5","type": "'+type+'","accountNum": "'+accountNum+'"}}')

                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command": "61","content": {"page": \"'+page+'\","rows": "3","type": "'+type+'","accountNum": "'+accountNum+'"}}'
                        },
                        dataType: 'json',
                        success: function(data){
                            //console.log('{"command": "61","content": {"page": \"'+page+'\","rows": "3","type": "'+type+'","accountNum": "'+accountNum+'"}}')
                            if(!data.success || !data.obj.rows || data.obj.rows.length==0){
                                me.lock();
                                me.noData(true);
                            }else{
                                //社团活动
                                var render = H.tppl(H.D("#activityTppl").innerHTML); //
                                var result = render({list:data.obj.rows});
                                $('.team_activity_list').append(result);

                                page++;
                            }

                            // 每次数据加载完，必须重置
                            me.resetload();
                            me.unlock();
                            me.noData(false);
                        },
                        error: function(xhr, type){
                            // 即使加载出错，也得重置
                            me.resetload();
                            me.noData(true);
                        }
                    });

                }

            })

//
        })

    }


    //获取个人信息
    function getUserInfo() {
        $.ajax({
            type: 'post',
            url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
            data:{
                jsonStr:'{ "command": "27", "content": { "accountNum": "'+accountNum+'" } }'
            },
            dataType: 'json',
            success: function(data){

                if(data.obj) {
                    var picAb = B.getImageAbsoluteUrl(data.obj.picture_xd);
                    $('#userAvatar').attr('src',picAb);
                    $('#dingNum').html(data.obj.favoriteNumber);
                    $('#userName').html(data.obj.name);
                    $('#phoneNum').html(data.obj.phoneNum);
                    if(data.obj.sex==0){
                        $('#sex_flag')
                                .addClass('H-icon-man')
                                .removeClass('H-icon-woman')
                                .removeClass("H-theme-font-color11")
                                .addClass("H-theme-font-color1");
                    }
                    else {
                        $('#sex_flag')
                                .addClass('H-icon-woman')
                                .removeClass('H-icon-man')
                                .removeClass("H-theme-font-color1")
                                .addClass("H-theme-font-color11");
                    }
                }

            },
            error: function(xhr, type){
                //alert(type)

            }
        });

    }

    //创建新的活动
    function createPlan() {
        // 获取表单数据
        var topic = $("#topic").val();  //组织主题
        var plannedPeopleNum = $("#plannedPeopleNum").val();  //计划人数

        var backSchoolTime = $("#backSchoolTime").val(); //返校时间
        var classItem = $("#classItem").val(); //班级
        var describe = $("#describe").val();  //活动描述


        // 校验表单数据
        if ($.trim(topic) == '') {
            H.alert(function () {
                $("#topic").focus();
            }, "请输入组织主题！");
            return false;
        }
        else if ($.trim(plannedPeopleNum) != '' && !(/^[1-9]+\d*$/.test(plannedPeopleNum))) {
            H.alert(function () {
                $("#plannedPeopleNum").focus();
            }, '人数上限应为大于0的整数值或留空不设上限！');
            return false;
        }
        else if ($.trim(backSchoolTime) == '') {
            H.alert("请选择返校时间！");
            return false;
        }
        else if ($.trim(classItem) == '') {
            H.alert("请选择班级！");
            return false;
        }
        else if ($.trim(describe) == '') {
            H.alert(function () {
                $("#describe").focus();
            }, "请输入活动详情描述！");
            return false;
        }


        // 入参组合
        var formData = {
            command: "82",
            content: {
                topic: topic,
                number: plannedPeopleNum,
                time: backSchoolTime.replace(/T/, " ") + ":00",
                classinfo: classItem,
                other:describe,
                userId: accountNum
            }
        };

//        console.log("------------"+JSON.stringify(formData));

        // 调用服务端接口，提交保存新建的活动
        B.ready(function () {
            $.ajax({
                type: 'post',
                url: B.serverUrl + '/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                data: {
                    jsonStr: JSON.stringify(formData)
                },
                dataType: 'json',
                success: function (data) {

                    console.log("创建计划===="+JSON.stringify(data));


                    //创建时正在加载, 加载样式
                    var manban =
                            $('<div id="manban" style="position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; z-index: 9999; background: transparent;">' +
                                    '<div style=" position: absolute; left: 50%; top: 50%; margin-left: -65px; margin-top: -55px; width: 130px; height: 110px; display: -webkit-box;' +
                                    ' -webkit-box-orient: vertical; -webkit-box-align: center; text-align: center; background: rgba(0, 0, 0, 0.65); border-radius: 6px; color: #fff; font-size: 16px;">' +
                                    '<img style="width: 37px; margin-top:20px;margin-bottom: 5px" src="../../img/loading-jiazai.gif">' +
                                    '<p style="margin: 0;">加载中...</p></div></div>');
                    $("body").append(manban);

                    // 保存成功
                    //提示用户方式2: 使用 H.alertTipForCreatePlan() ,是H.js中自定义提示框
                    H.alertTipForSuccuss(function(){

                        //删除正在加载
                        //获取div节点对象
                        var divNode2 = document.getElementById("manban");
                        //获取父节点
                        var parentNode = divNode2.parentNode;
                        parentNode.removeChild(divNode2);

                        //创建成功后, 调到"我的" tab
                        $("#content3").show();

                    }," 活动发起成功,等待工作人员审核");
                    return;

                },
                error: function (xhr, type) {
                    // 保存失败
                }
            });

        })


    }


    //点击某社团, 进入 社团详情
    function detailTeam(teamId) {
        H.openWin("社团详情", "detail.html?ts="+B.getRandomInt(4)+"&associationId=" + teamId+"&accountNum="+accountNum +"&detailFlag=20");
    }

    /*var t = B.getUrlParamByName("t");
    var rnumber = Math.floor(Math.random()*1000)
    history.replaceState({mod:rnumber}, 'Title', '?t='+t+'&accountNum='+accountNum+'&mod='+rnumber);
    window.onpopstate = function(event) {
        location.reload();
        //alert("location: " + document.location);
    };



    if(!t || t=='null' || t!=1){
        $(function(){
            pushHistory();
            window.addEventListener("popstate", function(e) {
                pushHistory();
                var ua = navigator.userAgent.toLowerCase();
                if(ua.match(/MicroMessenger/i)=="micromessenger") {
                    WeixinJSBridge.call('closeWindow');
                    AlipayJSBridge.call('closeWebview');
                    BLightApp.closeWindow();
                    window.close();
                } else if(ua.indexOf("alipay")!=-1){
                    AlipayJSBridge.call('closeWebview');
                }else if(ua.indexOf("baidu")!=-1){
                    BLightApp.closeWindow();
                }
                else{
                    window.close();
                }
            }, false);
            function pushHistory() {
                var state = {
                    title: "title",
                    url: "#"
                };
                window.history.pushState(state, "title", "#");
            }
        });
    }*/

    //ios返回刷新
//    var t = B.getUrlParamByName("t");
//    $(function () {
//        var u = navigator.userAgent, app = navigator.appVersion;
//        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
//        var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
//        if (isAndroid) {
//
//        }
//        if (isIOS) {
//            var rnumber = Math.floor(Math.random()*1000)
//            history.replaceState({mod:rnumber}, 'Title', '?t='+t+'&accountNum='+accountNum+'&mod='+rnumber);
//            window.onpopstate = function(event) {
//                location.reload();
//            };
//        }
//    });

    //返回
    var jsonStr = {
        "title":"我的社团",
        "btn1":{
            "imgname":"icon_Back@2x.png",
            "imgversion":"20170214",
            "imgbase64":"iVBORw0KGgoAAAANSUhEUgAAABoAAAAsCAYAAAB7aah+AAAAAXNSR0IArs4c6QAAAN1JREFUWAntlkEOgkAMRRkTVl7EA3gPD+D53MjGa7lyr4vxF2gghkIHqnHxmzQdMp3+6YOkVFWw5ZxP8Cu8Di49lOtFnohiN3i8GIpKJyqCZWuxYig5JdJrdZ3thsbXrUQEJxt4PCa90kIn0tF2dBRR3K5IXC5MmkRcSsIVicuFSZOIS0l4owy+M3xuaF1SSi9vQTMP76aGy4CyTP4DZIpuNxSiGDHaBPiB2GwKdoixAJadSow2m4Kdf8N4x4X2Bfe3U2c6e2DvaJ9csTMhFi+i9xqJfU/kQ+ygzz+Pb1Kohi6oSMRTAAAAAElFTkSuQmCC",
            "name":"返回",
            "action":"fallback"
        }
    }
    function menuConfig() {
        window.webkit.messageHandlers.AppModel.postMessage({body: jsonStr});
        return jsonStr;
    }
    function jsonConfig() {
        var str = JSON.stringify(jsonStr);
        window.stub.jsMethod(str);
        return jsonStr;
    }

    function fallback() {

        window.location.href = B.serverUrl + "/mobile/services/team/index.html?accountNum=" + accountNum;

    }
</script>

</body>
</html>
