<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0">
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<!-- UC强制全屏 -->
	<meta name="full-screen" content="yes">
	<!-- QQ强制全屏 -->
	<meta name="x5-fullscreen" content="true">
	<title>创建活动</title>
	<link href="../static/css/Hui.css" rel="stylesheet" type="text/css">
	<style>	
		label{min-width:50px;}
		input{text-align:right;}
		input{width: 100%;padding-right: 23px;}
		#startTime,#endTime,#signupStartTime,#signupEndTime{padding-right:5px;}
		li:nth-of-type(4),li:nth-of-type(5),li:nth-of-type(6),li:nth-of-type(7){padding-right: 0;}
		li:nth-of-type(4) i,li:nth-of-type(5) i,li:nth-of-type(6) i,li:nth-of-type(7) i{position: absolute;right: 8px;top: 15px;}
		input::-webkit-input-placeholder{text-align: right;}
		input::-ms-input-placeholder{text-align: right;}
		input::-moz-input-placeholder{text-align: right;}
		.user_name{position: absolute;right: 33px;}
		#stay{position: absolute;right: 33px;}
		.click{position: absolute;right: 10px;top: 15px;}
		li:nth-child(3),li:nth-child(5){border-bottom:16px solid #f8f8f8;}
		.H-padding-horizontal-right-5{padding-right: 0;}
	</style>
</head>

<body>

<header id="header"></header>

<!-- list-->
<div class="H-margin-vertical-both-10">

	<ul class="H-theme-background-color-white H-margin-vertical-top-10">
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				主题：
			</label>
			<input type="text" id="title" class="H-vertical-align-middle H-vertical-middle H-font-size-14 H-border-none H-outline-none H-margin-horizontal-left-10" placeholder="请输入活动主题20字以内">
		</li>
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				地址：
			</label>
			<input type="text" id="place" class="H-vertical-align-middle H-vertical-middle H-font-size-14 H-border-none H-outline-none H-margin-horizontal-left-10" placeholder="请填写活动地点">
		</li>
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				发起人：
			</label>
			     <span id="userName" class="user_name" >姓名</span>
		</li>
			<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999" style="min-width: 80px;">
				开始时间：
			</label>
			<input id="startTime" type="datetime-local"
				   style="border: none; outline: none; width: 100%; background: transparent;" placeholder="请选择报名开始时间">
		</li>
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999" style="min-width: 80px;">
				结束时间：
			</label>
			<input id="endTime" type="datetime-local"
				   style="border: none; outline: none; width: 100%; background: transparent;" placeholder="请选择报名开始时间">
		</li>
			<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999" style="min-width: 80px;">
				报名开始：
			</label>
			<input id="signupStartTime" type="datetime-local"
				   style="border: none; outline: none; width: 100%; background: transparent;" placeholder="请选择报名开始时间">
		</li>
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999" style="min-width: 80px;">
				报名结束：
			</label>
			<input id="signupEndTime" type="datetime-local"
				   style="border: none; outline: none; width: 100%; background: transparent;" placeholder="请选择报名开始时间">
		</li>
		
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999" style="min-width: 80px;">
				活动详情：<span id="stay" style="display: inline;color:red">&nbsp;<span id="txtCount"></span>/5000字</span></span>
			</label>
		</li>
		
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-padding-vertical-both-10 H-border-vertical-bottom-after">		
	<textarea id="content"  class="H-textbox H-width-100-percent H-vertical-align-middle H-vertical-middle H-font-size-14
						H-theme-font-color-black H-border-none H-outline-none" placeholder="请输入活动详情描述"></textarea>
		</li>
		<li class="H-position-relative H-padding-10">
			<input type="hidden" id="pic" name="pic" value="">
			<input type="file" id="picNative" name="picNative" onchange="getPicUrl(this);" style="display: none;">
			<div onclick="selectPic()"
				 class="H-width-100-percent H-height-100-percent H-center-all H-border-style-dashed H-theme-border-color1"
				 style="min-height: 100px; position: relative;">
				<img id="picPreview" name="picPreview" src="" style="display: none;width: 100%;" />
				<div id="uploadImg" class="H-text-align-center">
					<i class="H-iconfont H-icon-camera H-font-size-22 H-theme-font-color-999"></i>
					<label class="H-display-block H-font-size-14">上传海报图片</label>
				</div>
			</div>

		</li>
	</ul>

	<ul class="H-theme-background-color-white H-margin-vertical-top-10">
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				费用：
			</label>
			<div id="costSelect">
						<span class="H-icon H-vertical-middle H-position-absolute H-float-right" style="right: 10px;">
							<label id="costText" class="H-display-block H-vertical-middle H-theme-font-color-999 H-font-size-14 H-padding-horizontal-right-5">免费</label>
	  						<i class="H-iconfont H-icon-arrow-right H-font-size-12 H-theme-font-color-999 H-vertical-middle"></i>	  				
	  					</span>
				<input type="hidden" id="cost" />
			</div>
		</li>
			<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				收费说明：
			</label>
			<div id="costmemoSelect">
						<span class="H-icon H-vertical-middle H-position-absolute H-float-right" style="right: 10px;">
							<label id="costmemoText" class="H-display-block H-vertical-middle H-theme-font-color-999 H-font-size-14 H-padding-horizontal-right-5"></label>
	  						<i class="H-iconfont H-icon-arrow-right H-font-size-12 H-theme-font-color-999 H-vertical-middle"></i>	  				
	  					</span>
				<input type="hidden" id="costmemo" />
			</div>
		</li>
		<li class="H-padding-horizontal-both-10 H-flexbox-horizontal H-border-vertical-bottom-after H-padding-vertical-both-10">
			<label class="cy-label H-vertical-middle H-font-size-14 H-theme-font-color-999">
				人数上限：
			</label>
			<input type="number" min="1" step="1" id="maxPeople" class="H-vertical-align-middle H-vertical-middle H-font-size-14 H-border-none H-outline-none H-margin-horizontal-left-10" placeholder="留空则为不设上限">
		</li>
	</ul>

	<ul class="H-theme-background-color-white H-margin-vertical-top-10">
		<li class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active">
			<div class="cy-label H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-theme-font-color-999 H-padding-vertical-both-12">
				需要签到
			</div>
			<input type="checkbox" id="isNeedSignIn" checked="checked" class="H-switch H-display-block H-position-relative H-theme-background-color-white H-theme-font-color1 H-margin-horizontal-right-10">
		</li>
	</ul>
	<div class="cy-label H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-theme-font-color-999 H-padding-vertical-both-12">
				说明：开启此项后，活动发布成功后即可生成一个专属校验码，该校验友仅活动发起人可见。报名成员在自己的活动详情界面输入校验码即可获得签到二维码，扫描/识别二维码即可签到。
			</div>
	
</div>

<div style="height: 50px;"></div>

<ul class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-top-after" style="position: fixed; z-index: 9999; bottom: 0;">
	<li class="H-flex-item H-padding-5">
		<button id="submitBtn" class="H-button H-font-size-15 H-width-100-percent H-outline-none H-padding-vertical-both-8 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click H-theme-font-color1-click H-border-radius-3">提&nbsp;&nbsp;交</button>
	</li>
</ul>

<script src="../../js/H.js" type="text/javascript"></script>
<script src="../../js/zepto.min.js" type="text/javascript"></script>
<script src="../../js/xdomain.min.js" type="text/javascript"></script>
<script src="../../js/B.js" type="text/javascript"></script>
<script type="text/javascript" src="../../js/jbase64.js" ></script>
<script type="text/javascript" src="../../js/wechat.js" ></script>
<script src="../static/js/lrz.mobile.min.js"></script>
<script src="../../js/jquery.min.js" type="text/javascript" ></script>
<script src="../static/plug/layer/layer.js" type="text/javascript" ></script>

<script type="text/javascript">
	

    // 接收URL中的参数
    var sourceFlag = B.getUrlParamByName("sourceFlag");

    var accountNum = B.getUrlParamByName("accountNum");

    var openId = localStorage.getItem("openId");
	var fromMain = B.getUrlParamByName("fromMain");

	var biaozhi = B.getUrlParamByName("biaozhi");
	var teamId = B.getUrlParamByName("teamId");




    if(openId && openId != "null") {
        // 微信端
        accountNum = localStorage.getItem("accountNum");

        if(!accountNum || accountNum == ''){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
					if(fromMain && fromMain=='1'){
						H.openWin("登陆页面", "../../wechat/login.html?backUrl=" + B.encrypt('../services/activity/add.html?sourceFlag=' + sourceFlag)+"&ts=" + B.getRandomInt(4)+"&fromMain="+fromMain) ;
					}else{
						H.openWin("登陆页面", "../../wechat/login.html?backUrl=" + B.encrypt('../services/activity/add.html?sourceFlag=' + sourceFlag)+"&ts=" + B.getRandomInt(4));
					}

                }
                else{
                    history.back();
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }

        var shareData = {
            title: '创建活动',
            desc: '',
            link: location.href.split('?')[0],
            imgUrl: ''
        };
        mkShareInfo(location.href, shareData, 1);
    }

	


	var backUrl = "";
	switch(sourceFlag) {
		case '1': backUrl = "/mobile/services/activity/list_user.html?ts="+B.getRandomInt(4)+"&accountNum="+accountNum; break;
		case '2': backUrl = "/mobile/services/activity/list_user_create.html?ts="+B.getRandomInt(4)+"&accountNum="+accountNum; break;
		default: backUrl = "/mobile/services/activity/list.html?ts="+B.getRandomInt(4)+"&accountNum=" + accountNum;
	}

	// 对谁可见列表
	var perAlumniData = [
		{id:"",name:"公开"}
	];

	$(function(){
		B.ready(function(){
			// 查询当前用户已加入且为正式会员的所有分会
			$.ajax({
				type: 'post',
				url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
				data:{
					jsonStr:'{"command": "28","content": {"type": "-1","userId": "'+ accountNum +'","isJoin": "1","status": "20"}}'
				},
				dataType: 'json',
				success: function(data){
					if(data.obj && data.obj.length > 0){
						for(var i = 0; i < data.obj.length; i++){
							var item = {id:data.obj[i].id, name:data.obj[i].name};
							perAlumniData[i+1] = item;
						}
					}
				},
				error: function(xhr, type){
					// 保存失败
				}
			});

			// 提交保存表单，新建活动
			$("#submitBtn").click(function(){
				// 获取表单数据
				var title = $("#title").val();
				var place = $("#place").val();
				var content = $("#content").val();
				var pic = $("#pic").val();
				var signupStartTime = $("#signupStartTime").val();
				var signupEndTime = $("#signupEndTime").val();
				var startTime = $("#startTime").val();
				var endTime = $("#endTime").val();
				var perAlumniId = $("#perAlumniId").val();
				var cost = $("#cost").val();
				var costMemo = $("#costmemo").val();
				var maxPeople = $("#maxPeople").val();
				var isNeedSignIn = 0;
				if($("#isNeedSignIn")[0].checked){
					isNeedSignIn = 1;
				}

				// 校验表单数据
				if($.trim(title) == ''){
					H.alert(function(){
						$("#title").focus();
					}, "请输入活动主题！");
					return false;
				}
				else if($.trim(place) == ''){
					H.alert(function(){
						$("#place").focus();
					}, "请输入活动地点！");
					return false;
				}
				else if($.trim(content) == ''){
					H.alert(function(){
						$("#content").focus();
					}, "请输入活动详情描述！");
					return false;
				}
				else if($.trim(pic) == ''){
					H.alert("请上传活动海报图片！");
					return false;
				}
				else if($.trim(signupStartTime) == ''){
					H.alert("请选择活动报名开始时间！");
					return false;
				}
				else if($.trim(signupEndTime) == ''){
					H.alert("请选择活动报名结束时间！");
					return false;
				}
				else if($.trim(startTime) == ''){
					H.alert("请选择活动开始时间！");
					return false;
				}
				else if($.trim(endTime) == ''){
					H.alert("请选择活动结束时间！");
					return false;
				}
				else if($.trim(maxPeople) != '' && !(/^[1-9]+\d*$/.test(maxPeople))){
					H.alert(function(){
						$("#maxPeople").focus();
					}, '人数上限应为大于0的整数值或留空不设上限！');
					return false;
				}
				else if($.trim(cost) != '' && !(/^(\d+\.\d{1,2}|\d+)$/.test(cost))) {
					H.alert(function(){
						$("#cost").focus();
					}, '请输入正确格式的费用金额数（元）！');
					return false;
				}

				// 入参组合
				var formData = {
					command: "213",
					content: {
						title: title,
						place: place,
						content: content,
						pic: pic,
						signupStartTime: signupStartTime.replace(/T/," ") + ":00",
						signupEndTime: signupEndTime.replace(/T/," ") + ":00",
						startTime: startTime.replace(/T/," ") + ":00",
						endTime: endTime.replace(/T/," ") + ":00",
						perAlumniId: perAlumniId,
						cost: cost,
						costMemo: costMemo,
						maxPeople: maxPeople,
						needSignIn: isNeedSignIn,
						userInfoId: accountNum
					}
				};

				console.log("------------"+JSON.stringify(formData));

				// 调用服务端接口，提交保存新建的活动
				$.ajax({
					type: 'post',
					url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
					data:{
						jsonStr:JSON.stringify(formData)
					},
					dataType: 'json',
					success: function(data){
						if (data && data.success) {
							//创建时正在加载
							var manban = $('<div id="manban" style="position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; z-index: 9999; background: transparent;"><div style=" position: absolute; left: 50%; top: 50%; margin-left: -65px; margin-top: -55px; width: 130px; height: 110px; display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: center; text-align: center; background: rgba(0, 0, 0, 0.65); border-radius: 6px; color: #fff; font-size: 16px;"><img style="width: 37px; margin-top:20px;margin-bottom: 5px" src="../../img/loading-jiazai.gif"><p style="margin: 0;">加载中...</p></div></div>');
							$("body").append(manban);
							console.log(data)
							// 保存成功
							H.alert(function () {

								//删除正在加载
								//获取div节点对象
								var divNode2 = document.getElementById("manban");
								//获取父节点
								var parentNode = divNode2.parentNode;
								parentNode.removeChild(divNode2);
								H.closeWin();
//								H.openWin("我创建的", "list_user_create.html?accountNum=" + accountNum+"&fromMain="+fromMain +"&teamId="+teamId);
							}, data.msg);
							setTimeout(function(){
								window.location.href = B.serverUrl + "/mobile/services/activity/list.html?accountNum=" + accountNum +"&teamId="+teamId;
							},2000)
						}
						else{
							H.alert(data.msg)
						}
					},
					error: function(xhr, type){
						// 保存失败
					}
				});
			});
		});
	});

	// 选择本地图片
	function selectPic(){
		$("#picNative").trigger("click");
	}

	// 获取图片改变后的地址
	function getPicUrl(obj){
		// 验证上传图片
		var fileExt = document.getElementById('picNative').value;
		var fileName = "";

		if(fileExt != null && fileExt != ''){

			fileName = fileExt.substring(0,fileExt.lastIndexOf("."));
			fileName = fileName.substr(fileName.lastIndexOf("\\")+1, fileName.length);

			fileExt = fileExt.substr(fileExt.lastIndexOf("."), fileExt.length);
			if(fileExt == null || fileExt == ''){
				$.dialog({
					title:'温馨提示',
					content:'请确认上传的文件包含正确的扩展名',
					button:["确认"]
				});
				return;
			}

			fileExt = fileExt.toLowerCase();
			if(fileExt=='.gif' || fileExt=='.jpg' || fileExt=='.png' || fileExt=='.bmp' || fileExt=='.jpeg'){
			}else{
				$.dialog({
					title:'温馨提示',
					content:'请上传正确的图片文件',
					button:["确认"]
				});
				return;
			}
		}

		// 图片压缩
		lrz(obj.files[0], {
			width: 400,
			quality: 0.8,
			done: function (results) {
				// 预览选择的图片
				$("#picPreview").attr("src", results.base64).show();
				$("#uploadImg").hide();

				// 入参数组合
//					H.alert(results.base64);

				var uploadImgParam = {
					uploadFileBase64:results.base64.substring(results.base64.lastIndexOf(",") + 1),
					uploadFileName:fileName + fileExt,
					jsonStr:'{"command": "1","content": {"accountNum": "'+accountNum+'","type": "1"}}'
				};

				// 上传图片到服务器，返回图片在服务器的完整地址
				$.ajax({
					type: 'post',
					url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
					data:uploadImgParam,
					dataType: 'json',
					success: function(data){
						// 将图片地址保存于隐藏域
						$("#pic").val(data.obj);
					},
					error: function(xhr, type){
						// 保存失败
					}
				});
			}
		});
	}

	// 对谁可见，下拉选择分会
	H.on(H.Ds("#perAlumniIdSelect"), "touchend", function(event){
		H.selectTipByJsonArray(
				this,
				perAlumniData,
				function (index, value, id) {
					$("#perAlumniLabel").text(value);
					$("#perAlumniId").val(id);
				},
				function (index, value, id) {
				},
				$("#perAlumniId").val()
		)
	});

	// 费用，弹出输入框
	H.on(H.Ds("#costSelect"), "touchend", function(event) {
		H.prompt(function(ret,err){
			var cost = ret.text;

			if(cost && 5 > cost.length > 0 && cost != '0'){
				$("#costText").html(cost + "元");
				$("#cost").val(cost);
			}
			else if( cost.length >= 5 ){
				layer.alert("金額不可超過5位數");
			}
			else{
				$("#costText").html("免费");
				$("#cost").val(0);
			}
		},"活动费用","输入0或空表示免费",$("#cost").val());
	});

	// 费用说明，弹出输入框
	H.on(H.Ds("#costmemoSelect"), "touchend", function(event) {
		H.prompt(function(ret,err){
			var cost = ret.text;
            	$("#costmemoText").html(cost);
				$("#costmemo").val(cost);
			
		},"活动费用","输入收费说明",$("#costmemo").val());
	});


//	$("#signupStartTime").change(function(){
//		document.getElementById("signupEndTime").value = $(this).val();//赋初始值
//		document.getElementById("startTime").value = $(this).val();//赋初始值
//		document.getElementById("endTime").value =$(this).val();//赋初始值
//	})

//	//ios返回刷新
//	var t = B.getUrlParamByName("t");
//	$(function () {
//		var u = navigator.userAgent, app = navigator.appVersion;
//		var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
//		var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
//		if (isAndroid) {
//
//		}
//		/*if (isIOS) {
//			var rnumber = Math.floor(Math.random()*1000)
//			history.replaceState({mod:rnumber}, 'Title', '?t='+t+'&accountNum='+accountNum+'&mod='+rnumber+"&fromMain="+fromMain +"&biaozhi="+biaozhi+"&teamId="+teamId );
//			window.onpopstate = function(event) {
//				location.reload();
//			};
//		}*/
//	});

	var jsonStr = {

		"title":"创建活动",
		"btn1":{
			"imgname":"icon_Back@2x.png",
			"imgversion":"20170214",
			"imgbase64":"iVBORw0KGgoAAAANSUhEUgAAABoAAAAsCAYAAAB7aah+AAAAAXNSR0IArs4c6QAAAN1JREFUWAntlkEOgkAMRRkTVl7EA3gPD+D53MjGa7lyr4vxF2gghkIHqnHxmzQdMp3+6YOkVFWw5ZxP8Cu8Di49lOtFnohiN3i8GIpKJyqCZWuxYig5JdJrdZ3thsbXrUQEJxt4PCa90kIn0tF2dBRR3K5IXC5MmkRcSsIVicuFSZOIS0l4owy+M3xuaF1SSi9vQTMP76aGy4CyTP4DZIpuNxSiGDHaBPiB2GwKdoixAJadSow2m4Kdf8N4x4X2Bfe3U2c6e2DvaJ9csTMhFi+i9xqJfU/kQ+ygzz+Pb1Kohi6oSMRTAAAAAElFTkSuQmCC",
			"name":"返回",
			"action":"fallback"
		}
	}
	function menuConfig() {
		window.webkit.messageHandlers.AppModel.postMessage({body: jsonStr});
		return jsonStr;

	}
	function jsonConfig() {
		var str = JSON.stringify(jsonStr);
		window.stub.jsMethod(str);
		return jsonStr;

	}

	function fallback() {
		if(biaozhi && biaozhi != null && biaozhi != ''){
			if(biaozhi == 10){
				window.location.href = B.serverUrl + "/mobile/services/activity/list_user.html?accountNum=" + accountNum +"&teamId="+teamId;
			}else{
				window.location.href = B.serverUrl + "/mobile/services/activity/list_user_create.html?accountNum=" + accountNum +"&teamId="+teamId;
			}
		}else{
			return;
		}
	}

    if(accountNum!= '')
	{
	loadUserInfo();
	}
    // 初始化用户信息
    function loadUserInfo() {
        $.ajax({
            type: "post",
            url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
            data:{
                jsonStr:'{"command": "27","content": {"accountNum": "' + accountNum + '"}}'
            },
            dataType: "json",
            success: function(data){
                if (data && data.success) {
                 //   initPage(data.obj);
                      // 用户姓名
                   $(".user_name").text(data.obj.name);
                }
            }
        });
    }


</script>

  <script>
    var lim=new limit();
    lim.txtNote=document.getElementById("content");
    lim.txtLimit=document.getElementById("txtCount");
    lim.limitCount=5000;
    lim.init();
    function limit(){
        var txtNote;//文本框
        var txtLimit;//提示字数的input
        var limitCount;//限制的字数
        var txtlength;//到达限制时，字符串的长度
        this.init=function(){
            txtNote=this.txtNote;
            txtLimit=this.txtLimit;
            limitCount=this.limitCount;
            txtNote.oninput=function(){wordsLimit()};txtNote.oninput=function(){wordsLimit()};
            txtLimit.innerText=5000 - limitCount;
        };
        function wordsLimit(){
            var noteCount=txtNote.value.length;
            var InPut=document.getElementById("content").value.length;
            if(InPut<1){
                document.getElementById("stay").style.display="none";
                return
            }
            if(InPut>=1){
                document.getElementById("stay").style.display="inline";
                document.getElementById("stay").style.color="green";
            }
            if(InPut>70){
                document.getElementById("stay").style.color="red";
            }
            if(noteCount>limitCount){
                txtNote.value=txtNote.value.substring(0,limitCount);
                txtLimit.innerText=0;
            }else{
                txtLimit.innerText=5000 - (limitCount-noteCount);;
            }
            txtlength=txtNote.value.length;//记录每次输入后的长度
        }
    }
</script>

</body>

</html>
