<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新朋友</title>
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <!--css-->
    <link href="../static/plug/swiper/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/Hui.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/dropload.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../static/css/font_my_center/iconfont.css" type="text/css" media="screen,print">
    <link href="../static/css/my_center.css" rel="stylesheet" type="text/css" />

</head>
<body>

<div class="input_wai">
    <form action="" onsubmit="return false;" class=" H-position-relative">
        <div id="ser" class="H-position-absolute H-z-index-100 H-width-100-percent H-height-100-percent H-vertical-middle H-text-align-center H-theme-font-color-999  H-border-radius-15" style="">
                <span class="H-display-block H-width-100-percent H-font-size-14">
                    <i id="ss_brn" class="H-iconfont H-icon-search H-font-size-14"></i>
                    <span id="ss_title">请输入名称</span>
                </span>
        </div>
        <input onsearch="newpengyou()" type="search" class="top-input" id="sousuo_byn" placeholder="">
        <div class="sanchu" style="display: none;position: absolute;top: 5px;right: 5px;background: #999999;color:#fff;width: 20px;height: 20px;line-height: 20px;font-size:12px;text-align: center;border-radius: 50%">×</div>
    </form>
</div>


<div id="new_list">
    <!--
    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active H-padding-vertical-both-10">
        <img src="../static/img/icon_avatar@3x.png" class="H-border-radius-circle H-display-block H-margin-horizontal-left-10" style="width:40px;height:40px;">
        <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden H-position-relative">
            <div class="H-width-100-percent" style="box-sizing: border-box;padding-right: 60px;">
                <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-14 H-text-show-row-1">啊啊啊<span class="H-icon H-display-inline-block H-padding-horizontal-both-5"><i class="H-iconfont H-icon-man H-vertical-middle H-font-size-14 H-theme-font-color9"></i></span></strong>
                <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1">计算机科学与信息工程学院   2012级   2班   [ 广州科技大学 ]</div>
            </div>
            <div class="H-position-absolute" style="top: 10px;right: 10px;font-size: 12px; color: #999999">
                已同意
            </div>
        </div>
    </div>
    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active H-padding-vertical-both-10">
        <img src="../static/img/icon_avatar@3x.png" class="H-border-radius-circle H-display-block H-margin-horizontal-left-10" style="width:40px;height:40px;">
        <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden H-position-relative">
            <div class="H-width-100-percent" style="box-sizing: border-box;padding-right: 60px;">
                <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-14 H-text-show-row-1">啊啊啊<span class="H-icon H-display-inline-block H-padding-horizontal-both-5"><i class="H-iconfont H-icon-man H-vertical-middle H-font-size-14 H-theme-font-color9"></i></span></strong>
                <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1">计算机科学与信息工程学院   2012级   2班   [ 广州科技大学 ]</div>
            </div>
            <div class="H-position-absolute" style="top: 10px;right: 10px;font-size: 12px; color: #999999">
                已拒绝
            </div>
        </div>
    </div>
    -->

</div>
<script type="text/html" id="newList">
    <%
    for(var i in newList){
        if(newList[i].applicantFlag==0){
    %>
            <div onclick='H.openWin("新好友详情", "newfriend_detail.html?accountNum=<%=accountNum%>&userId=<%=newList[i].accountNum%>");' class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active H-padding-vertical-both-10">

                    <img onerror="javascript:this.src='../static/img/default_profile.png';" src="<%=newList[i].picture%>" class="H-border-radius-circle H-display-block H-margin-horizontal-left-10" style="width:40px;height:40px;">
                    <div style="position:relative">
                    <%
                    if(newList[i].baseInfoId && newList[i].baseInfoId!==''){
                    %>
                        <img src="../static/img/verify_flag.png" class="verify_pic verify_icon_small">
                    <%
                    }else {
                    %>
                        <img src="../static/img/unverified@3x.png" class="verify_pic verify_icon_small">
                    <%
                    }
                    %>
                    </div>

                <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden H-position-relative">
                    <div class="H-width-100-percent" style="box-sizing: border-box;padding-right: 75px;padding: 5px 0;">
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-14 H-text-show-row-1"><%=newList[i].name%>
                            <span class="H-icon H-display-inline-block H-padding-horizontal-both-5">
                                <%
                                if(newList[i].sex==0){
                                %>
                                    <i class="H-iconfont H-icon-man H-vertical-middle H-font-size-14" style="color:#4e7cfd"></i>
                                <%
                                }else if(newList[i].sex==1){
                                %>
                                    <i class="H-iconfont H-icon-woman H-vertical-middle H-font-size-14" style="color:#ff9a7c"></i>
                                <%
                                }else{
                                }
                                %>
                            </span>
                        </strong>
                        <%
                        if(newList[i].departName && newList[i].departName!=''){
                        %>
                        <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1"><%=newList[i].departName%></div>
                        <%
                        }else{
                        %>
                        <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1"></div>
                        <%
                        }
                        %>
                    </div>
                    <div onclick="addagree('<%=newList[i].accountNum%>')" class="H-position-absolute"
                         style="top: 5px;right: 50px;font-size: 12px;color: #fff;background: #3498db;padding: 2px 5px;border-radius: 3px;">
                        同意
                    </div>
                    <div onclick="noaddagree('<%=newList[i].accountNum%>',this)" class="H-position-absolute"
                         style="top: 5px;right: 10px;font-size: 12px;color: #fff;background: #999999;padding: 2px 5px;border-radius: 3px;">
                        拒绝
                    </div>
                </div>
            </div>
    <%
        }else if(newList[i].applicantFlag==1){
    %>

            <div onclick='H.openWin("申请好友", "sq_friend_detail.html?accountNum=<%=accountNum%>&userId=<%=newList[i].accountNum%>");' class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active H-padding-vertical-both-10">

                <img onerror="javascript:this.src='../static/img/default_profile.png';" src="<%=newList[i].picture%>" class="H-border-radius-circle H-display-block H-margin-horizontal-left-10" style="width:40px;height:40px;">

                <div style="position:relative">
                <%
                if(newList[i].baseInfoId && newList[i].baseInfoId!=''){
                %>
                    <img src="../static/img/verify_flag.png" class="verify_pic verify_icon_small">
                    <%
                    }else {
                    %>
                    <img src="../static/img/unverified@3x.png" class="verify_pic verify_icon_small">
                    <%
                    }
                    %>
                </div>
                <div class="H-flex-item H-padding-horizontal-both-10 H-vertical-middle H-overflow-hidden H-position-relative">
                    <div class="H-width-100-percent" style="box-sizing: border-box;padding-right: 75px;padding: 5px 0;">
                        <strong class="H-font-weight-normal H-display-block H-font-weight-500 H-font-size-14 H-text-show-row-1"><%=newList[i].name%>
                            <span class="H-icon H-display-inline-block H-padding-horizontal-both-5">
                                <%
                                if(newList[i].sex==0){
                                %>
                                    <i class="H-iconfont H-icon-man H-vertical-middle H-font-size-14" style="color:#4e7cfd"></i>
                                <%
                                }else if(newList[i].sex==1){
                                %>
                                    <i class="H-iconfont H-icon-woman H-vertical-middle H-font-size-14" style="color:#ff9a7c"></i>
                                <%
                                }else{
                                }
                                %>
                            </span>
                        </strong>
                        <%
                        if(newList[i].departName && newList[i].departName != ''){
                        %>
                        <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1"><%=newList[i].departName%></div>
                        <%
                        }else{
                        %>
                        <div class="H-theme-font-color-999 H-font-size-12 H-text-show-row-1"></div>
                        <%
                        }
                        %>
                    </div>
                    <div class="H-position-absolute" style="top: 10px;right: 10px;font-size: 12px; color: #3498db">
                        待认证
                    </div>
                </div>
            </div>
    <%
        }else{

        }
    }
    %>
</script>



</body>

<!--引入脚本文件-->
<script src="../static/plug/swiper/swiper.min.js" type="text/javascript"></script>
<script src="../../js/H.js" type="text/javascript"></script>
<script src="../../js/zepto.min.js" type="text/javascript" ></script>
<script src="../../js/xdomain.min.js" type="text/javascript"></script>
<script src="../../js/B.js" type="text/javascript" ></script>
<script src="../static/js/lrz.mobile.min.js"></script>
<script src="../static/js/dropload.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="../../js/jbase64.js" ></script>
<script type="text/javascript" src="../../js/wechat.js" ></script>
<script type="text/javascript">
    // 接收参数
    var accountNum = B.getUrlParamByName("accountNum");

    var openId = localStorage.getItem("openId");
    if(openId && openId != "null") {
        // 微信端
        accountNum = localStorage.getItem("accountNum");

        if(!accountNum || accountNum == ''){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("tongxunlu/news_friend.html?ts=" + B.getRandomInt(4));
                    H.openWin("登陆页面", "../login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl);
                }
                else{
                    history.back();
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }
        var shareData = {
            title: '新好友',
            desc: '',
            link: location.href.split('?')[0],
            imgUrl: ''
        };
        mkShareInfo(location.href, shareData, 1);
    }

    $(function(){
        // 定义模板标识符
        H.tppl_flag = ["<%", "%>"];
        //未认证好友列表
        newsfriend('')
    });

    //未认证好友列表
    function newsfriend(friendName){
        $("#new_list").empty();
//        console.log('{"command": "241","content": {"userId": "'+accountNum+'", "status": "0","friendName":"'+friendName+'"} }')
        B.ready(function(){
            $.ajax({
                type: 'post',
                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                data:{
                    jsonStr:'{"command": "241","content": {"userId": "'+accountNum+'", "status": "0","friendName":"'+friendName+'"} }'
                },
                dataType: 'json',
                success: function(data){
//                    console.log(data.obj.length);
//                    console.log("需要通过验证的好友列表:"+JSON.stringify(data));
                    if(data.obj.length>0 && data.success){
                        var render = H.tppl(H.D("#newList").innerHTML);
                        var result = render({newList:data.obj});
                        $('#new_list').append(result);

                    }
                },
                error: function(xhr, type){
                }
            });
        });
    }

    //同意申请
    function addagree(e){
        window.event? window.event.cancelBubble = true : e.stopPropagation();
        H.confirmTip(function (ret) {
            if(ret.buttonIndex==1){
                B.ready(function(){
                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command": "43","content": {"userId": "'+accountNum+'","contactId": "'+e+'","applicantFlag": "0" ,"status":"1"} }'
                        },
                        dataType: 'json',
                        success: function(data){
                            if(data.success)
                            H.toastTip(function(){
                                var commonParams = "?ts=" + B.getRandomInt(4) + "&accountNum="+accountNum;
                                H.openWin("新朋友", "news_friend.html?commonParams="+commonParams);
                            }, '已加为好友', 2000);
                        },
                        error: function(xhr, type){
                        }
                    });
                });

            }
        }, '确认提示：', '您确定要同意该请求吗？');

    }

    //拒绝申请
    function noaddagree(e,obj){
        window.event? window.event.cancelBubble = true : e.stopPropagation();
        H.confirmTip(function (ret) {
            if(ret.buttonIndex==1){
                B.ready(function(){
                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command": "44","content": {"userId": "'+accountNum+'","contactId": "'+e+'"} }'
                        },
                        dataType: 'json',
                        success: function(data){
                            if(data.success){
                                $(obj).parent().parent().hide();
                                H.toastTip(function(){null},'已拒绝好友添加', 2000);
                            }

                        },
                        error: function(xhr, type){
                        }
                    });
                });
            }
        }, '确认提示：', '您确定要拒绝该请求吗？');

    }


    //搜索框
    $('.top-input').val('')
    H.D("#ser").addEventListener("touchend", function (e) {
        $("#ser").css('width','30px');
        $('#ss_title').hide();
        $('.top-input').css('text-align','left');
        $('.top-input').attr("placeholder", "请输入名称");
    });
    $('.top-input').focus(function(){
        $('.sanchu').show();
    })
    $('.top-input').blur(function(){

        if($('.top-input').val()==''){
            $("#ser").css('width','100%');
            $('#ss_title').show();
            $('.top-input').css('text-align','center').val('');
            $('.top-input').attr("placeholder", " ");
            $('.sanchu').hide();
            newsfriend('');
        }
    })
    $('.sanchu').click(function(){
        $("#ser").css('width','100%');
        $('#ss_title').show();
        $('.top-input').css('text-align','center').val('');
        $('.top-input').attr("placeholder", " ");
        newsfriend('');
        $('.sanchu').hide();
    })


    //搜索新朋友
    function newpengyou(){
        var name=$("#sousuo_byn").val();
        newsfriend(name);
    }


//    //ios返回刷新页面
//    var rnumber = Math.floor(Math.random()*1000)
//    history.replaceState({mod:rnumber}, 'Title', '?accountNum='+accountNum+'&mod='+rnumber);
//    window.onpopstate = function(event) {
//        location.reload();
//        //alert("location: " + document.location);
//    };

</script>


</html>