<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>计划详情</title>
    <link href="../static/plug/swiper/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/Hui.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/dropload.css" rel="stylesheet" type="text/css" />
    <link href="../static/css/backSchool.css" rel="stylesheet" type="text/css" />
    <link href="font/iconfont.css" rel="stylesheet" type="text/css" />

    <!--remove the height100% from html-->
    <style tyle="">
        html{
            height:auto;
        }

        .centerxy{
            max-height: 400px;
            overflow: hidden;
        }
        #click_more{
            position: relative;
            text-align: center;
            width: 100%;
            height: 35px;
            font-size: 12px;
            line-height: 35px;
            box-sizing: border-box;
            padding: 0 10px;

        }
        #click_more span{
            color: #00a5e0;
            display: inline-block;
        }
        .right_hao{
            margin-left: 5px;
            transition: all 0.5s ease;

        }
        .right_hao1{
            animation:myfirst1 2s;
            -webkit-animation:myfirst1 2s; /* Safari and Chrome */
            animation-iteration-count:infinite;
            -webkit-animation-iteration-count:infinite;

            transform:translateY(-5px);
        }
        .right_hao2{
            animation:myfirs2t 2s;
            -webkit-animation:myfirst2 2s; /* Safari and Chrome */
            animation-iteration-count:infinite;
            -webkit-animation-iteration-count:infinite;

            transform:translateY(5px);
        }
        @keyframes myfirst1
        {
            0%   {transform:translateY(-5px);color: #00a5e0;;}
            100% {transform:translateY(5px);color: #a4e7ff;;}
        }
        @-webkit-keyframes myfirst1 /* Safari and Chrome */
        {
            0%   {transform:translateY(-5px);color: #00a5e0;;}
            100% {transform:translateY(5px);color: #a4e7ff;;}
        }
        @keyframes myfirst2
        {
            0%   {transform:translateY(5px);color: #00a5e0;;}
            100% {transform:translateY(-5px);color: #a4e7ff;;}
        }
        @-webkit-keyframes myfirst2 /* Safari and Chrome */
        {
            0%   {transform:translateY(5px);color: #00a5e0;;}
            100% {transform:translateY(-5px);color: #a4e7ff;;}
        }

    </style>

    <!--Tppl-->



</head>

<body class="H-flexbox-vertical">


<div class="H-padding-vertical-bottom-10"></div>


<!--div-top: 顶部 计划介绍: titil+图片+文字+点赞-->
<div class="infor_box">
    <div class="bbs-item H-border-vertical-bottom-after">
        <!--title-->
        <div class="H-theme-background-color-white H-theme-font-color15 H-padding-horizontal-both-10 H-padding-vertical-top-12 H-padding-vertical-bottom-5 H-font-size-17 H-text-align-center plan_titel" style="padding-right: 65px;padding-left: 65px;padding-bottom: 10px;">
            <!--校友风采-->
        </div>
        <div onclick="baominga()" class="baoming_btn">

        </div>
        <div class="H-theme-background-color-white H-theme-font-color15 H-padding-horizontal-both-10 H-padding-vertical-top-5 H-margin-vertical-bottom-5 H-font-size-14" style="padding-bottom: 5px">
            <div id="contents1" class="centerxy">
                <img class="post_pic" onerror="javascript:this.src='../static/img/banner4@3x.png';" src="../static/img/banner4@3x.png" alt="" title="" class="H-display-block">
            </div>
            <div id="click_more">
                <span class="more_btn">查看更多</span><span class="right_hao right_hao1"> ︾ </span>
            </div>
        </div>

        <!--点赞之类-->
        <div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box box-bottom">

            <span class="H-font-size-12 H-flex-item H-text-align-right  H-center-all H-theme-font-color1" style="border-bottom: 1px solid #dedede;height: 11px;">
            </span>
            <span class="H-font-size-12 H-flex-item H-text-align-right  H-center-all H-theme-font-color1">
                <i onclick="" class="H-iconfont H-icon-star-fill H-font-size-14 H-margin-horizontal-right-5 shoucang_btn"></i>
                <label class="H-display-inline-block H-vertical-middle shoucang">0</label>
            </span>
            <span class="H-font-size-12 H-flex-item  H-center-all H-theme-font-color-999">
                <i class="H-iconfont H-icon-review H-font-size-14 H-margin-horizontal-right-5 fpinglun_bun pinglunnum_tp"></i>
                <label class="H-vertical-middle pinglunnum">0</label>
            </span>
            <span class="H-font-size-12 H-flex-item H-text-align-left H-center-all H-theme-font-color-999">
                <i class="H-iconfont H-icon-ding-fill H-font-size-14 H-margin-horizontal-right-5 dianzan_btn" style="pointer-events:none;"></i>
                <label class="H-vertical-middle dianzannum">0</label>
            </span>
            <span class="H-font-size-12 H-flex-item H-text-align-right  H-center-all H-theme-font-color1" style="border-bottom: 1px solid #dedede;height: 11px;">
            </span>
        </div>
    </div>

</div>

<!--div-2 班级人数等信息  -->
<div class="attend_box">
    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
        <span class="H-icon H-display-block H-margin-horizontal-left-10">
            <i class="H-iconfont H-icon-star H-font-size-18 H-vertical-middle H-theme-font-color10"></i>
            <!--<i class="icon iconfont icon-banjiquan H-font-size-22 H-vertical-middle H-theme-font-color8"></i>-->
        </span>
        <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12" style="display:inline-block;width: 90px;">年级范围</div>

        <span class="H-padding-horizontal-right-10 H-display-block H-theme-font-color-666 H-font-size-12" style="position: absolute;top: 0px;right: 0;display: table;margin-left: 110px;height: 45px;">
            <span class="banji" style="display: table-cell;vertical-align: middle;text-align: right;">
                <!--<span style="display: inline-block;">研发1部一班</span>-->
                <!--<span style="display: inline-block;">研发1部一班</span>-->
                <!--<span style="display: inline-block;">123</span>-->
                <!--<span style="display: inline-block;">研发1部一班</span>-->
            </span>
        </span>

    </div>

    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
        <span class="H-icon H-display-block H-margin-horizontal-left-10">
            <i class="H-iconfont H-icon-dengpao H-font-size-18 H-vertical-middle H-theme-font-color11"></i>
            <!--<i class="icon iconfont icon-banjiquan H-font-size-22 H-vertical-middle H-theme-font-color8"></i>-->
        </span>
        <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">计划人数</div>
        <span class="H-padding-horizontal-right-10 H-display-block H-theme-font-color-666 H-font-size-12 renshu"> </span>
    </div>

    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
        <span class="H-icon H-display-block H-margin-horizontal-left-10">
            <i class="H-iconfont H-icon-time H-font-size-18 H-vertical-middle H-theme-font-color12"></i>
            <!--<i class="icon iconfont icon-banjiquan H-font-size-22 H-vertical-middle H-theme-font-color8"></i>-->
        </span>
        <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">返校时间</div>
        <span class="H-padding-horizontal-right-10 H-display-block H-theme-font-color-666 H-font-size-12 shijian"> </span>
    </div>

    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
        <span class="H-icon H-display-block H-margin-horizontal-left-10">
            <i class="H-iconfont H-icon-user2 H-font-size-18 H-vertical-middle H-theme-font-color13"></i>
            <!--<i class="icon iconfont icon-banjiquan H-font-size-22 H-vertical-middle H-theme-font-color8"></i>-->
        </span>
        <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">报名人</div>
        <span class="H-padding-horizontal-right-10 H-display-block H-theme-font-color-666 H-font-size-12 baoming">[<span class="baomingrenshu"></span>]</span>
    </div>

</div>

<!--div-3 报名人数列表 横向-->
<div class="attend_person">

    <div class="H-n-grid H-border-vertical-top-after H-clear-both">
        <div id="peolist" class="H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box H-theme-background-color-white">
            <!--<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">-->
                <!--<div>-->
                    <!--<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img src="../static/img/icons/icon_avatar@3x.png" class="H-display-block H-border-radius-circle H-width-45 H-height-45"></span>-->
                    <!--<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">新闻通知</label>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">-->
                <!--<div>-->
                    <!--<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img src="../static/img/icons/icon_avatar@3x.png" class="H-display-block H-border-radius-circle H-width-45 H-height-45"></span>-->
                    <!--<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">新闻通知</label>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">-->
                <!--<div>-->
                    <!--<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img src="../static/img/icons/icon_avatar@3x.png" class="H-display-block H-border-radius-circle H-width-45 H-height-45"></span>-->
                    <!--<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">新闻通知</label>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">-->
                <!--<a href="list_avatar.html" class="H-text-decoration-none">-->
                    <!--<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img style="border: 1px dashed #6e6e6e" src="../static/img/plus.png" class="H-display-block H-border-radius-circle H-width-45 H-height-45" alt="" title=""></span>-->
                    <!--<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">更多</label>-->
                <!--</a>-->
            <!--</div>-->
        </div>
    </div>
</div>



<script type="text/html" id="pConter">

    <%
    for(var i in pConter){
    %>

    <div id="replaylist">
        <div class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after">
            <div class="H-padding-vertical-both-8">

                <img onerror="javascript:this.src='../static/img/icons/default_profile.png';" id="face1" src="<%=B.getImageAbsoluteUrl(pConter[i].userPic)%>" srcs="" alt="" title="" class="imgCache H-display-block H-margin-horizontal-left-10 H-border-radius-circle" style="width: 40px; height: 40px;">

            </div>
            <div class="H-flex-item H-margin-vertical-both-8 H-margin-10">
                <div class="H-theme-font-color-999 H-font-size-14 H-flexbox-horizontal H-text-horizontal-left H-box-sizing-border-box">
                    <span class="H-display-block H-flex-item H-text-align-left H-font-size-14 H-theme-font-color1"><%=pConter[i].userName?pConter[i].userName:''%></span>
                                <span class="H-display-block H-flex-item H-text-align-right H-theme-font-color-999 H-font-size-12">
                                   <i onclick="fpinglun_bun('<%=pConter[i].id%>','<%=pConter[i].userName%>')" class="H-iconfont H-icon-answer H-font-size-15 H-theme-font-color13 fpinglun_bun"></i>
                                    <span class="H-margin-horizontal-right-5"><%=pConter[i].commentNumber%></span>

                                    <!--判断是否已经点赞-->
                                    <%
                                    if(pConter[i].hasPraised==1){
                                    %>
                                        <i onclick="dianzan(this,'<%=pConter[i].id%>')" class="H-iconfont H-icon-ding-fill H-font-size-15 H-theme-font-color13"></i>
                                    <%
                                    }else{
                                    %>
                                        <i onclick="dianzan(this,'<%=pConter[i].id%>')" class="H-iconfont H-icon-ding-fill H-font-size-15 H-theme-font-color-999"></i>
                                    <%
                                    }
                                    %>


                                    <span class="H-margin-horizontal-right-5 fudznum"><%=pConter[i].praiseNumber%></span>
                                </span>
                </div>
                <div class="H-font-size-10 H-theme-font-color-999 H-text-show-row-1 H-font-size-10">
                    <%=pConter[i].createDate%>
                </div>
                <div class="H-font-size-12 H-text-show-row-2 H-margin-vertical-top-5">
                    <%=pConter[i].content%>
                </div>
            </div>
        </div>
        <!--评论回复-->

        <%
        if(pConter[i].child){
        %>
        <div class="H-padding-5 H-theme-background-color-eee pinglun" style="padding-bottom:15px;">
            <div class="sanjiao"></div>
            <div class="H-border-radius-3 H-padding-5 H-theme-background-color-white H-font-size-14">
                <%
                for(var j in pConter[i].child ){
                //if(pConter[i].child[j].userName)
                %>
                <div>
                    <span class="H-theme-font-color1 pinnames"><%=pConter[i].child[j].userName?pConter[i].child[j].userName:''%> ：</span>
                    <%=pConter[i].child[j].content%>
                </div>
                <%
                }
                %>
            </div>
        </div>
        <%
        }
        %>

    </div>

    <%
    }
    %>

</script>
<!--div-4 评论 列表: 头像 评论内容-->
<div class="comment_box">
    <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active">
        <span class="H-icon H-display-block H-margin-horizontal-left-10">
            <i class="H-iconfont H-icon-answer H-font-size-18 H-vertical-middle H-theme-font-color10"></i>
        </span>
        <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-14 H-padding-vertical-both-12">评论</div>
        <span class="H-padding-horizontal-right-10 H-display-block H-font-size-12 H-theme-font-color-666">[<font class="pinglunnum"></font>] </span>
    </div>
    <!--评论 列表: 头像+评论内容-->
    <div id="pinl_conter">





    </div>
</div>

<!--发送 评论-->
<div class="boxgao" style="height: 64px;"></div>
<div id="cf_box" class="H-position-fixed" style="bottom: 0;left: 0;right: 0; z-index: 9999;background: #eee">
    <div style="box-sizing: border-box;margin-right: 140px;padding: 5px">
        <input id="chufa_inp" class="H-textbox" placeholder="写评论.." style="height: 25px;border-radius: 13px;background: #fff;border: none;padding-left: 10px;font-size: 12px;width: 100%;box-sizing: border-box;">
    </div>
    <div style="position: absolute;top: 10px;right: 0px; width: 140px;display: -webkit-inline-box;">
        <span class="H-font-size-12 H-flex-item  H-center-all H-theme-font-color-999">
            <i onclick="pinglunlist()" class="H-iconfont H-icon-review H-font-size-14 H-margin-horizontal-right-5 fpinglun_bun pinglunnum_tp"></i>
            <label class="H-vertical-middle pinglunnum">0</label>
        </span>
        <span class="H-font-size-12 H-flex-item H-text-align-right  H-center-all H-theme-font-color1">
            <i onclick="soucang()" class="H-iconfont H-icon-star-fill H-font-size-14 H-margin-horizontal-right-5 shoucang_btn H-theme-font-color-999"></i>
            <label class="H-display-inline-block H-vertical-middle shoucang H-theme-font-color-999">0</label>
        </span>
        <span class="H-font-size-12 H-flex-item H-text-align-left H-center-all H-theme-font-color-999">
            <i class="H-iconfont H-icon-ding-fill H-font-size-14 H-margin-horizontal-right-5 dianzan_btn" onclick="zhudianzan(1)"></i>
            <label class="H-vertical-middle dianzannum">0</label>
        </span>
    </div>
</div>
<div id="shushun" class="H-text-list H-theme-background-color-white shuru_box" style="display: none;width: 100%;height: 120px;">

    <div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-top-10" style="height: 92px">
        <textarea id="pl_input" flag="1" type="text" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16
H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-8
H-background-color-transparent-1 H-width-100-percent" placeholder="评论" style="min-height:10px;height: 100%;border-radius: 3px;background: #ededed;"></textarea>
    </div>
    <!--发送Btn-->
    <button id="dasong_btn" class="H-button H-font-size-12 H-outline-none H-border-none
    H-theme-background-color1 H-theme-font-color-white
    H-theme-background-color1-click
    H-theme-font-color1-click" style="min-width: 0px;float: right;margin-right: 10px;margin-top: 4px;padding: 1px 18px;border-radius: 3px;">发送</button>

    <button id="quxiao_btn" class="H-button H-font-size-12 H-outline-none H-border-none
    H-theme-background-color-999 H-theme-font-color-white
    H-theme-background-color-999-click
    H-theme-font-color1-click" style="min-width: 0px;float: right;margin-right: 10px;margin-top: 4px;padding: 1px 18px;border-radius: 3px;">取消</button>

</div>


</body>

<script src="../static/plug/swiper/swiper.min.js" type="text/javascript"></script>
<script src="../../js/H.js" type="text/javascript"></script>
<script src="../../js/zepto.min.js" type="text/javascript" ></script>
<script src="../../js/xdomain.min.js" type="text/javascript"></script>
<script src="../../js/B.js" type="text/javascript" ></script>
<script src="../static/js/dropload.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="../../js/jbase64.js" ></script>
<script type="text/javascript" src="../../js/wechat.js" ></script>
<script type="text/javascript">
    // 接收URL中的参数
    var categoryId = B.getUrlParamByName("categoryId");

    var accountNum = B.getUrlParamByName("accountNum");

    var sourceFlag = B.getUrlParamByName("sourceFlag");


    var openId = localStorage.getItem("openId");
    if(openId && openId != "null") {
        // 微信端
        accountNum = localStorage.getItem("accountNum");
        $("title").html("计划详情");
    }else {
        var historyUrl = "";
        if(sourceFlag && sourceFlag != ''){
            switch(sourceFlag) {
                case '1': historyUrl = "/mobile/services/backSchool/list_plan.html?accountNum="+accountNum; break;
                case '2': historyUrl = "/mobile/services/backSchool/my_jihua.html?accountNum="+accountNum; break;
                default: historyUrl = "/mobile/services/backSchool/list_plan.html?accountNum=" + accountNum;
            }
        }else{
            historyUrl = "/mobile/services/backSchool/list_plan.html?ts="+B.getRandomInt(4)+"&accountNum=" + accountNum;
        }
        //alert('{"title":"计划详情","backUrl":"' + historyUrl + '","backTitle":"返回"}');
        $("title").html('{"title":"计划详情","backUrl":"' + historyUrl + '","backTitle":"返回"}');
    }

    var userIds='';
    // 初始化页面
    $(function(){
        // 定义模板标识符
        H.tppl_flag = ["<%", "%>"];

        B.ready(function(){
            //判断是否已认证
            renzhenguser()
            //加载计划详情
            loadingxinixi();
        });

    });

    //判断是否已认证
    var userrz='';
    function renzhenguser(){
        $.ajax({
            type: 'POST',
            url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
            data:{
                jsonStr:'{"command": "27","content": {"accountNum": "'+accountNum+'"}}'
            },
            dataType: 'json',
            success: function(data){
                if(data.obj && data.obj.baseInfoId){
                    userrz = 1;
                }else{
                    userrz = 0;
                }
            },
            error: function(xhr, type){
                // 加载出错
            }
        });
    }

    //加载计划详情
    function loadingxinixi(){
        console.log('{"command": "84","content": {"id": \"'+categoryId+'\","userId": \"'+accountNum+'\"}}')
        $.ajax({
            type: 'post',
            url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
            data:{
                jsonStr:'{"command": "84","content": {"id": \"'+categoryId+'\","userId": \"'+accountNum+'\"}}'
            },
            dataType: 'json',
            success: function(data){
                userIds=data.obj.userId;

                if(data.success==true && data.obj){
                    if(openId && openId != 'null'){
                        var title = data.obj.topic;
                        var desc = data.obj.other;
                        var imgUrl = B.getImageAbsoluteUrl(data.obj.posterUrl);
                        var shareData = {
                            title: title,
                            desc: desc,
                            link: location.href.split('?')[0]+'?categoryId='+categoryId,
                            imgUrl: imgUrl
                        };
                        mkShareInfo(location.href, shareData, 0);
                    }
                    $('.plan_titel').html(data.obj.topic);
                    $('.post_pic').attr('src',B.getImageAbsoluteUrl(data.obj.posterUrl));
                    if(data.obj.content){
                        $('#contents1').append(data.obj.content);
                        console.log($('#contents1').height());
                    }
//                    if($('#contents1').height()>400){
//                        $('#contents1').addClass('centerxy')
//                        console.log('加上了');
//                        $('#click_more').show();
//                    }
                    $('.shoucang').html(data.obj.favoriteNumber);
                    $('.pinglunnum').html(data.obj.commentNumber);
                    $('.dianzannum').html(data.obj.praiseNumber);
                    $('.dianzan_btn').attr('onclick','zhudianzan('+data.obj.hasPraised+')');

                    var className= new Array();
                    var listName='';
                    if (data.obj.classInfoName && data.obj.classInfoName !=''&&data.obj.classInfoName!='null'){
                        className=data.obj.classInfoName.split(',');
                        for(var i in className){
                            listName+='<span style="display:inline-block">'+className[i]+'</span>'+' > ';
                        }
                    }
                    $('.banji').html(listName.substring(0,listName.length-2));
                    if(data.obj.number==0){
                        $('.renshu').html("不限");
                    }else{
                        $('.renshu').html(data.obj.number);
                    }


                    if(data.obj.time){
                        var begintime=data.obj.time
                    }else{
                        var begintime=' ';
                    }
                    if(data.obj.endTime){
                        var endtime=data.obj.endTime;
                    }else{
                        var endtime=' ';
                    }
                    $('.shijian').html(begintime+' / '+endtime);

                    $('.baomingrenshu').html(data.obj.countMember);

                    //收藏。。
                    if(data.obj.hasFavorited==0){
                        $('.shoucang_btn').addClass('H-theme-font-color-999')
                        $('.shoucang').addClass('H-theme-font-color-999')
                    }else{
                        $('.shoucang_btn').removeClass('H-theme-font-color-999')
                        $('.shoucang').removeClass('H-theme-font-color-999')
                    }
                    //点赞。。
                    if(data.obj.hasPraised==0){
                        $('.dianzan_btn').removeClass('H-theme-font-color1');
                        $('.dianzannum').removeClass('H-theme-font-color1');
                    }else{
                        $('.dianzan_btn').addClass('H-theme-font-color1');
                        $('.dianzannum').addClass('H-theme-font-color1');
                    }

                    //报名
                    if(data.obj.isSigned==0){
                        $('.baoming_btn').text('报名');
                        isSigneds=0;
                    }else{
                        $('.baoming_btn').text('已报名');
                        $('.baoming_btn').attr('onclick','baominga(0)');
                        isSigneds=1;
                    }

                    if(data.obj.status==50){
                        $('.baoming_btn').html('已取消');
                        $('.baoming_btn').removeAttr('onclick');
                    }
                    if(data.obj.status==40){
                        $('.baoming_btn').html('已下线');
                        $('.baoming_btn').removeAttr('onclick');
                    }


                    //是否为发起人
                    var isOw='';
                    if(data.obj.isOwner==1){
                        isOw=1;
                    }
                    //当前活动状态
                    if( data.obj.isOwner==1){
                        if( data.obj.timeState==2 ){
                            $('.baoming_btn').text('已结束');
                            $('.baoming_btn').removeAttr('onclick');
                        }else if(data.obj.status!=40 && data.obj.status!=50){
                            $('.baoming_btn').text('取消');
                            $('.baoming_btn').attr('onclick','delbaominga()');
                        }
                    }
                    if( data.obj.timeState==2 ){
                        $('.baoming_btn').text('已结束');
                        $('.baoming_btn').removeAttr('onclick');
                    }

                    //当前人的评论数量
                    if( data.obj.userCommentCount && data.obj.userCommentCount>2 ){
                        $('.pinglunnum_tp').addClass('H-theme-font-color13')
                    }

                    //报名人列表
                    huoqubmxx(isOw);

                }
            },
            error: function(xhr, type){
            }
        });
    }

    //报名人列表
    function huoqubmxx(isOw){
        $("#peolist").empty()
        console.log('{"command": "257","content": {"page": "1","rows": "3","backSchoolId": \"'+categoryId+'\" }}')
        $.ajax({
            type: 'post',
            url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
            data:{
                jsonStr:'{"command": "257","content": {"page": "1","rows": "3","backSchoolId": \"'+categoryId+'\" }}'
            },
            dataType: 'json',
            success: function(data){
                if(data.success==true && data.obj.length>0){
                    var list='',faqir='';

                    if(isOw==1){
                        for(var i in data.obj){
                            if(data.obj[i].accountNum==userIds) {
                                var userName = data.obj[i].name?data.obj[i].name:'';
                                faqir = '<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">' +
                                        '<div>' +
                                        '<span class="H-icon H-position-relative H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img onerror="javascript:this.src=\'../static/img/icons/default_profile.png\';" src="' + B.getImageAbsoluteUrl(data.obj[i].picture) + '" class="H-display-block H-border-radius-circle H-width-45 H-height-45"><img src="../static/img/duigou.png" style="position: absolute;width: 15px;height: 15px; z-index: 2;bottom: 0;right: 0;;"></span>' +
                                        '<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">' + userName + '</label>' +
                                        '</div>' +
                                        '</div>';
                                var x = i;
                                delete data.obj[x];
                            }
                        }
                        for(var i in data.obj){
                            var userName = data.obj[i].name?data.obj[i].name:'';
                            list += '<div onclick="go_haoyou('+data.obj[i].accountNum+')" tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">'+
                                    '<div>'+
                                    '<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;">' +
                                    '<img onerror="javascript:this.src=\'../static/img/icons/default_profile.png\';" src="'+B.getImageAbsoluteUrl(data.obj[i].picture)+'" class="H-display-block H-border-radius-circle H-width-45 H-height-45"></span>'+
                                    '<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">'+userName+'</label>'+
                                    '</div>'+
                                    '</div>';

                        }
                    }else{
                        for(var i in data.obj){
                            if(data.obj[i].accountNum==userIds) {
                                var userName = data.obj[i].name?data.obj[i].name:'';
                                faqir = '<div onclick="go_chuajian('+data.obj[i].accountNum+')" tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">' +
                                        '<div>' +
                                        '<span class="H-icon H-position-relative H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img onerror="javascript:this.src=\'../static/img/icons/default_profile.png\';" src="' + B.getImageAbsoluteUrl(data.obj[i].picture) + '" class="H-display-block H-border-radius-circle H-width-45 H-height-45"><img src="../static/img/duigou.png" style="position: absolute;width: 15px;height: 15px; z-index: 2;bottom: 0;right: 0;;"></span>' +
                                        '<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">' + userName + '</label>' +
                                        '</div>' +
                                        '</div>';
                                var x = i;
                                delete data.obj[x];
                            }
                        }
                        for(var i in data.obj){
                            var userName = data.obj[i].name?data.obj[i].name:'';
                            list += '<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">'+
                                    '<div>'+
                                    '<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img onerror="javascript:this.src=\'../static/img/icons/default_profile.png\';" src="'+B.getImageAbsoluteUrl(data.obj[i].picture)+'" class="H-display-block H-border-radius-circle H-width-45 H-height-45"></span>'+
                                    '<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">'+userName+'</label>'+
                                    '</div>'+
                                    '</div>';

                        }
                    }

                    $('#peolist').append(faqir);
                    $('#peolist').append(list);
                    $('#peolist').append('<div tapmode="" class="H-display-table-cell H-float-left H-box-sizing-border-box H-width-avg-4 H-center-all H-theme-background-color-white H-padding-vertical-both-10 H-touch-active" style="min-height: 80px;">'+
                            '<a onclick="chngyuanlist()" href="javascript:;" class="H-text-decoration-none cylista">'+
                            '<span class="H-icon H-display-block H-horizontal-center" style="width: 45px; height: 45px;"><img style="border: 1px dashed #6e6e6e" src="../static/img/plus.png" class="H-display-block H-border-radius-circle H-width-45 H-height-45" alt="" title=""></span>'+
                            '<label class="H-display-block H-font-size-12 H-text-align-center H-theme-font-color-999 H-margin-vertical-top-8">更多</label>'+
                            '</a>'+
                            '</div>');

                }


            },
            error: function(xhr, type){
            }
        });
    }


    //收缩简介
    $('#click_more').click(function(){
        $('#contents1').toggleClass('centerxy');
        if($('#contents1').hasClass('centerxy')){
            $('.more_btn').html('查看更多');
            $('.right_hao').html('︾');
            $('.right_hao').addClass('right_hao1').removeClass('right_hao2');
        }else{
            $('.more_btn').html('收起');
            $('.right_hao').html('︽');
            $('.right_hao').addClass('right_hao2').removeClass('right_hao1');
        }
    })


    //进入好友详情页面
    function go_haoyou(ids){
        H.openWin('好友详情', '../../wechat/tongxunlu/friend_detail.html?accountNum='+accountNum+'&userId='+ids);
    }
    //进入创建者详情页面
    function go_chuajian(ids){
        H.openWin('好友详情', '../../wechat/tongxunlu/friend_detail.html?accountNum='+accountNum+'&userId='+ids);
    }



    // 设置页签集合
    var tabs = [{
        name:"返校动态",
        url:"list_index.html"
    },{
        name:"计划列表",
        url:"list_plan.html"
    },{
        name:"我的计划",
        url:"my_jihua.html"
    }];
    page=1;
    function pinglunhuifuqq(){
        $('#pinl_conter').empty();
        page=2;
        B.ready(function(){
            $.ajax({
                type: 'post',
                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                data:{
                    jsonStr:'{"command":"256","content": {"bussId": \"'+categoryId+'\","userId": \"'+accountNum+'\","page":"1","rows":"5" }}'
                },
                dataType: 'json',
                success: function(data){
                    if((data.obj && data.obj.length==0) || !data.success ){

                    }else{
                        var render = H.tppl(H.D("#pConter").innerHTML);
                        var result = render({pConter:data.obj});

                        $('#pinl_conter').append(result);

                    }


                },
                error: function(xhr, type){

                }
            });
        })
    }
    // 评论回复
    $(function(){
        $('.comment_box').dropload({
            scrollArea : window,
            domDown : {
                domClass   : 'dropload-down',
                domRefresh : '<div class="dropload-refresh">↑上拉加载更多-评论内容</div>',
                domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中-亲，请耐心等待喔...</div>',
                domNoData  : '<div class="dropload-noData"> </div>'
            },
            loadDownFn : function(me){
                B.ready(function(){
                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command":"256","content": {"bussId": \"'+categoryId+'\","userId": \"'+accountNum+'\","page":\"'+page+'\","rows":"5" }}'
                        },
                        dataType: 'json',
                        success: function(data){
                            if((data.obj && data.obj.length==0) || !data.success ){
                                me.lock();
                                me.noData(true);
                            }else{
                                var render = H.tppl(H.D("#pConter").innerHTML);
                                var result = render({pConter:data.obj});

                                $('#pinl_conter').append(result);

                                page++;
                            }

                            // 每次数据加载完，必须重置
                            me.resetload();
                            me.unlock();
                            me.noData(false);
                        },
                        error: function(xhr, type){
                            // 即使加载出错，也得重置
                            me.resetload();
                            me.unlock();
                            me.noData(true);
                        }
                    });
                })

            },
            threshold : 50
        });
    });

    //主点赞
    function zhudianzan(xx){
        var dznum=parseInt($('.dianzannum').html());

        if(!accountNum || accountNum == 'null'){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                    window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }else if( userrz!=1 ){
            //认证提示区分微信端和APP端
            if (openId && openId !='' && openId != 'null'){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                    }
                }, '确认提示：', '尚未认证，是否去认证？');
            }else {
                H.alert('亲，您还未认证，请先去认证吧');
            }
        }else{
            pldz(categoryId,accountNum,'30','');
            if(xx==1){
                //已点赞
                $('.dianzannum').html(dznum-1);
                $('.dianzan_btn').attr('onclick','zhudianzan(0)');
                $('.dianzan_btn').removeClass('H-theme-font-color1');
                $('.dianzannum').removeClass('H-theme-font-color1');

            }else {
                //未点赞
                $('.dianzannum').html(dznum+1);
                $('.dianzan_btn').attr('onclick','zhudianzan(1)');
                $('.dianzan_btn').addClass('H-theme-font-color1');
                $('.dianzannum').addClass('H-theme-font-color1');
            }
        }

    }

    //取消计划
    function delbaominga(){
        H.confirm(function (ret) {
            if(ret.buttonIndex==1){
                B.ready(function(){
                    $.ajax({
                        type: 'post',
                        url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                        data:{
                            jsonStr:'{"command": "260","content": {"backSchoolId": "'+categoryId+'","userId": "'+accountNum+'"}}'
                        },
                        dataType: 'json',
                        success: function(data){
                            console.log(JSON.stringify(data))
                            if(data.success==true){
                                $('.baoming_btn').html('已取消');
                                $('.baoming_btn').removeAttr('onclick');
                                H.toastTip(null, '取消计划成功！', 2000);
                            }
                        },
                        error: function(xhr, type){

                        }
                    });
                });
            };
        }, '确认提示：', '您确认要取消该计划吗？');
    }

    //主收藏
    function soucang(){
        var shoucangNUms=parseInt($('.shoucang').html());
        if(!accountNum || accountNum == 'null'){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                    window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }else if( userrz!=1 ){
            //认证提示区分微信端和APP端
            if (openId && openId !='' && openId != 'null'){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                    }
                }, '确认提示：', '尚未认证，是否去认证？');
            }else {
                H.alert('亲，您还未认证，请先去认证吧');
            }
        }else{
            B.ready(function(){
                $.ajax({
                    type: 'post',
                    url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                    data:{
                        jsonStr:'{"command": "507","content": {"bussId": \"'+categoryId+'\","userId": \"'+accountNum+'\","bussType": "30"} }'
                    },

                    dataType: 'json',
                    success: function(data){
                        console.log(JSON.stringify(data))

                        if(data.success==true){
                            if(data.obj.code=='1'){
                                $('.shoucang').html(shoucangNUms+1);
                                $('.shoucang_btn').removeClass('H-theme-font-color-999');
                                $('.shoucang').removeClass('H-theme-font-color-999');
                                H.toastTip(null, data.msg , 2000);
                            }else{
                                $('.shoucang').html(shoucangNUms-1);
                                $('.shoucang_btn').addClass('H-theme-font-color-999')
                                $('.shoucang').addClass('H-theme-font-color-999')
                                H.toastTip(null, data.msg , 2000);
                            }
                        }
                    },
                    error: function(xhr, type){
                    }
                });
            });
        }

    }

    //点赞
    function dianzan(obj,dqcategoryId){
        if(!accountNum || accountNum == 'null'){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                    window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }else if( userrz!=1 ){
            //认证提示区分微信端和APP端
            if (openId && openId !='' && openId != 'null'){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                    }
                }, '确认提示：', '尚未认证，是否去认证？');
            }else {
                H.alert('亲，您还未认证，请先去认证吧');
            }
        }else{
            pldz(dqcategoryId,accountNum,'40','');
            var fudznums=parseInt($(obj).siblings('.fudznum').html());
            if($(obj).hasClass('H-theme-font-color13')){
                //已点赞
                $(obj).removeClass('H-theme-font-color13');
                $(obj).addClass('H-theme-font-color-999');
                $(obj).siblings('.fudznum').html(fudznums-1)
            }else{
                //未点赞
                $(obj).removeClass('H-theme-font-color-999');
                $(obj).addClass('H-theme-font-color13');
                $(obj).siblings('.fudznum').html(fudznums+1)
            }
        }
    }

    //评论
    function fpinglun_bun(ele,name){
        //alert(ele);
        //alert(name);

        $('#pl_input').focus();
        $('#pl_input').attr('placeholder','@'+name);
        $('#pl_input').attr('flag',ele);

        $('#shushun').show();
        $('#cf_box').hide();
    }

    //点击输入框外的内容的关闭输入框
    $(function(){
        $(document).on("click",function(e){
            //id为menu的是菜单，id为open的是打开菜单的按钮
            if($(e.target).closest("#shushun").length == 0 && $(e.target).closest(".fpinglun_bun").length == 0&& $(e.target).closest(".pinnames").length == 0){
                //点击id为menu之外且id不是不是open，则触发

                if($(e.target).closest("#cf_box").length == 0 && $(e.target).closest(".fpinglun_bun").length == 0&& $(e.target).closest(".pinnames").length == 0){

                    $('#shushun').hide();
                    $('#cf_box').show();
                }


                close();
            }
        })
    })
    function close(){
        $('#pl_input').attr('placeholder','评论');
        $('#pl_input').attr('flag','1')
        $('#pl_input').val('');

    }

    function addListener(element, e, fn) {
        if (element.addEventListener) {
            element.addEventListener(e, fn, false);
        } else {
            element.attachEvent("on" + e, fn);
        }
    }
    addListener(document, "click",function(evt) {
        var evt = window.event ? window.event: evt,
                target = evt.srcElement || evt.target;
        if (target.id == "chufa_inp") {

            if(!accountNum || accountNum == 'null'){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                    }
                }, '确认提示：', '尚未登陆，是否登陆账号？');
            }else if( userrz!=1 ){
                //认证提示区分微信端和APP端
                if (openId && openId !='' && openId != 'null'){
                    H.confirm(function (ret) {
                        if(ret.buttonIndex==1){
                            var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                            H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                        }
                    }, '确认提示：', '尚未认证，是否去认证？');
                }else {
                    H.alert('亲，您还未认证，请先去认证吧');
                }
            }else{
                $('#cf_box').hide();
                $('#shushun').show();
                $('#pl_input').focus();
                return;
            }
        } else {
            while (target.nodeName.toLowerCase() != "div" && target.nodeName.toLowerCase() != "html") {
                target = target.parentNode;
            }
            if (target.nodeName.toLowerCase() == "html") {
                $('#pl_input').attr('placeholder','评论');
                $('#pl_input').attr('flag','1')
                $('#pl_input').val('');
            }
        }
    })


    //取消评论信息
    $('#quxiao_btn').click(function(){
        $('#pl_input').attr('placeholder','评论');
        $('#pl_input').attr('flag','1')
        $('#pl_input').val('');
        $('#shushun').hide();
        $('#cf_box').show();
    })

    //发送评论信息
    $('#dasong_btn').click(function(){
        var pl_input=$('#pl_input').val()
        var types=10;
        var bId=categoryId;

        var flag=$('#pl_input').attr('flag');

        if(!accountNum || accountNum == 'null'){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                    window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }else if( userrz!=1 ){
            //认证提示区分微信端和APP端
            if (openId && openId !='' && openId != 'null'){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                    }
                }, '确认提示：', '尚未认证，是否去认证？');
            }else {
                H.alert('亲，您还未认证，请先去认证吧');
            }
        }else{
            if(pl_input!=''){
                if(flag==1){
                    //alert(flag)
                    pldz(bId,accountNum,types,pl_input,callb);
                    $('.pinglunnum').html(parseInt($('.pinglunnum').html())+1);
                    $('#shushun').hide();
                    $('#cf_box').show();
                }else{
                    //alert(flag)
                    var types=20;
                    pldz(flag,accountNum,types,pl_input,callb);
                    $('#shushun').hide();
                    $('#cf_box').show();
                }
            }else{
                H.alert('请填写内容');
            }
        }

    })
    //发送信息的回掉函数
    function callb(aa){
        if(aa=='1'){
//            H.alert('评论成功');
            $('#pinl_conter').empty();
            $('.dropload-down').remove();
            $('#pl_input').val('');
            pinglunhuifuqq();
        }else{
            H.alert('请填写评论内容')
        }
    }



    //评论点赞等。。公用接口
    function pldz(bussId,userId,type,content,callback){
        //alert('{"command": "255","content": {"bussId": \"'+bussId+'\","userId": \"'+userId+'\","type": \"'+type+'\","content": \"'+content+'\"}}')
        B.ready(function(){
            $.ajax({
                type: 'post',
                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                data:{
                    jsonStr:'{"command": "255","content": {"bussId": \"'+bussId+'\","userId": \"'+userId+'\","type": \"'+type+'\","content": \"'+content+'\"}}'
                },

                dataType: 'json',
                success: function(data){
                    console.log(JSON.stringify(data))
                    H.toastTip(null, data.msg , 2000);
                    var a='';
                    if(data.success==true){
                        a=1;
                    }else{
                        a=0;
                    }
                    if(callback){
                        callback(a);
                    }

                },
                error: function(xhr, type){
                }
            });
        });
    }

    //报名
    function baominga(obj){
        if(!accountNum || accountNum == 'null'){
            H.confirm(function (ret) {
                if(ret.buttonIndex==1){
                    var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                    window.location.href = "../../wechat/login.html?ts=" + B.getRandomInt(4) + "&backUrl=" + backUrl;
                }
            }, '确认提示：', '尚未登陆，是否登陆账号？');
        }else if( userrz!=1 ){
            //认证提示区分微信端和APP端
            if (openId && openId != '' && openId != 'null') {
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        var backUrl = B.encrypt("../services/backSchool/detail_plan.html?categoryId=" + categoryId);
                        H.openWin("认证页面", "../../wechat/verify/class_list.html?ts=" + B.getRandomInt(4) + "&accountNum=" + accountNum + "&backUrl=" + backUrl);
                    }
                }, '确认提示：', '尚未认证，是否去认证？');
            }else {
                H.alert('亲，您还未认证，请先去认证吧');
            }
        }else{
            if(obj==0){
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        B.ready(function(){
                            $.ajax({
                                type: 'post',
                                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                                data:{
                                    jsonStr:'{"command": "502","content": {"backSchoolId": \"'+categoryId+'\","accountNum": \"'+accountNum+'\" }}'
                                },

                                dataType: 'json',
                                success: function(data){
                                    console.log(JSON.stringify(data));
                                    if(data.success){
                                        $('.baoming_btn').text('报名');
                                        $('.baoming_btn').attr('onclick','baominga()');
                                        H.toastTip(null,data.msg, 2000);
                                        isSigneds=0;
                                        huoqubmxx();
                                        $('.baomingrenshu').html(parseInt($('.baomingrenshu').html())-1);
                                    }
                                    else {
                                        H.alert(data.msg);
                                    }

                                },
                                error: function(xhr, type){
                                }
                            });
                        });
                    }
                }, '确认提示：', '您确认要取消报名吗？');
            }else{
                H.confirm(function (ret) {
                    if(ret.buttonIndex==1){
                        B.ready(function(){
                            $.ajax({
                                type: 'post',
                                url: B.serverUrl+'/userProfile/userProfileAction!doNotNeedSessionAndSecurity_userProfileHandler.action',
                                data:{
                                    jsonStr:'{"command": "502","content": {"backSchoolId": \"'+categoryId+'\","accountNum": \"'+accountNum+'\" }}'
                                },

                                dataType: 'json',
                                success: function(data){
                                    console.log(JSON.stringify(data));
                                    if(data.success){
                                        $('.baoming_btn').text('已报名')
                                        $('.baoming_btn').attr('onclick','baominga(0)')
                                        H.toastTip(null,data.msg, 2000);
                                        isSigneds=1;
                                        huoqubmxx();
                                        $('.baomingrenshu').html(parseInt($('.baomingrenshu').html())+1);
                                    }else {
                                        H.alert(data.msg);
                                    }

                                },
                                error: function(xhr, type){
                                }
                            });
                        });
                    }
                }, '确认提示：', '您确认要报名该活动吗？');
            }
        }

    }

    //进入成员列表
    function chngyuanlist(){
        H.openWin('报名成员', 'list_avatar.html?accountNum=' + accountNum + '&categoryId=' + categoryId);
    }


    //验证是否为网址,因为有些图片地址在数据库中并不是一个有效地址
    function is_website(site_value){
        var site_value = site_value;
        var strRegex = "^((https|http)?://)";
        var re=new RegExp(strRegex);
        if (re.test(site_value)){
            return true;
        }else{
            return false;
        }
    }

    //点击显示评论输入
//    $("#chufa_inp").click(function(){
//        $('#cf_box').hide();
//        $('#shushun').show();
//        $('#pl_input').focus();
//    })

    //滚动到评论列表
    function pinglunlist(){
        scroller('pinl_conter', 200)

    }


//平滑滚动的算法-------------begin
    function intval(v)
    {
        v = parseInt(v);
        return isNaN(v) ? 0 : v;
    }
    // 获取元素信息
    function getPos(e)
    {
        var l = 0;
        var t  = 0;
        var w = intval(e.style.width);
        var h = intval(e.style.height);
        var wb = e.offsetWidth;
        var hb = e.offsetHeight;
        while (e.offsetParent){
            l += e.offsetLeft + (e.currentStyle?intval(e.currentStyle.borderLeftWidth):0);
            t += e.offsetTop  + (e.currentStyle?intval(e.currentStyle.borderTopWidth):0);
            e = e.offsetParent;
        }
        l += e.offsetLeft + (e.currentStyle?intval(e.currentStyle.borderLeftWidth):0);
        t  += e.offsetTop  + (e.currentStyle?intval(e.currentStyle.borderTopWidth):0);
        return {x:l, y:t, w:w, h:h, wb:wb, hb:hb};
    }
    // 获取滚动条信息
    function getScroll()
    {
        var t, l, w, h;
        if (document.documentElement && document.documentElement.scrollTop) {
            t = document.documentElement.scrollTop;
            l = document.documentElement.scrollLeft;
            w = document.documentElement.scrollWidth;
            h = document.documentElement.scrollHeight;
        } else if (document.body) {
            t = document.body.scrollTop;
            l = document.body.scrollLeft;
            w = document.body.scrollWidth;
            h = document.body.scrollHeight;
        }
        return { t: t, l: l, w: w, h: h };
    }
    // 锚点(Anchor)间平滑跳转
    function scroller(el, duration)
    {
        if(typeof el != 'object') { el = document.getElementById(el); }
        if(!el) return;
        var z = this;
        z.el = el;
        z.p = getPos(el);
        z.s = getScroll();
        z.clear = function(){window.clearInterval(z.timer);z.timer=null};
        z.t=(new Date).getTime();
        z.step = function(){
            var t = (new Date).getTime();
            var p = (t - z.t) / duration;
            if (t >= duration + z.t) {
                z.clear();
                window.setTimeout(function(){z.scroll(z.p.y, z.p.x)},13);
            } else {
                st = ((-Math.cos(p*Math.PI)/2) + 0.5) * (z.p.y-z.s.t) + z.s.t;
                sl = ((-Math.cos(p*Math.PI)/2) + 0.5) * (z.p.x-z.s.l) + z.s.l;
                z.scroll(st, sl);
            }
        };
        z.scroll = function (t, l){window.scrollTo(l, t)};
        z.timer = window.setInterval(function(){z.step();},13);
    }
//平滑滚动的算法---------------------end




//    //ios返回刷新
//    var t = B.getUrlParamByName("t");
//    $(function () {
//        var u = navigator.userAgent, app = navigator.appVersion;
//        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
//        var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
//        if (isAndroid) {
//
//        }
//        if (isIOS) {
//            var rnumber = Math.floor(Math.random()*1000)
//            history.replaceState({mod:rnumber}, 'Title', '?t='+t+'&accountNum='+accountNum+'&mod='+rnumber+ "&categoryId=" + categoryId +"&sourceFlag="+sourceFlag);
//            window.onpopstate = function(event) {
//                location.reload();
//            };
//        }
//    });

    var jsonStrBut = {
        "title":"计划详情",
        "btn1":{
            "imgname":"icon_Back@2x.png",
            "imgversion":"20170214",
            "imgbase64":"iVBORw0KGgoAAAANSUhEUgAAABoAAAAsCAYAAAB7aah+AAAAAXNSR0IArs4c6QAAAN1JREFUWAntlkEOgkAMRRkTVl7EA3gPD+D53MjGa7lyr4vxF2gghkIHqnHxmzQdMp3+6YOkVFWw5ZxP8Cu8Di49lOtFnohiN3i8GIpKJyqCZWuxYig5JdJrdZ3thsbXrUQEJxt4PCa90kIn0tF2dBRR3K5IXC5MmkRcSsIVicuFSZOIS0l4owy+M3xuaF1SSi9vQTMP76aGy4CyTP4DZIpuNxSiGDHaBPiB2GwKdoixAJadSow2m4Kdf8N4x4X2Bfe3U2c6e2DvaJ9csTMhFi+i9xqJfU/kQ+ygzz+Pb1Kohi6oSMRTAAAAAElFTkSuQmCC",
            "name":"返回",
            "action":"fallback"
        }
    }
    function menuConfig() {
        window.webkit.messageHandlers.AppModel.postMessage({body: jsonStrBut});
        return jsonStrBut;
    }
    function jsonConfig() {
        var str = JSON.stringify(jsonStrBut);
        window.stub.jsMethod(str);
        return jsonStrBut;
    }
    function fallback() {

//        window.location.href = B.serverUrl + "/mobile/services/backSchool/list_plan.html?accountNum=" + accountNum;
        //1:表示从计划列表进入；2：表示从我的计划进入
        if(sourceFlag && sourceFlag != '') {
            switch (sourceFlag) {
                case '1':
                    window.location.href = B.serverUrl +  "/mobile/services/backSchool/list_plan.html?accountNum=" + accountNum + "&categoryId=" + categoryId;
                    break;
                case '2':
                    window.location.href = B.serverUrl +  "/mobile/services/backSchool/my_jihua.html?accountNum=" + accountNum + "&categoryId=" + categoryId;
                    break;
                default:
                    window.location.href = B.serverUrl +  "/mobile/services/backSchool/list_plan.html?accountNum=" + accountNum + "&categoryId=" + categoryId;
            }
        }else {
            window.location.href = B.serverUrl +  "/mobile/services/backSchool/list_plan.html?accountNum=" + accountNum + "&categoryId=" + categoryId;
        }
    }

</script>


</html>
